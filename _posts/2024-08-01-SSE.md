---
layout : single
title : "[QnA ê²Œì‹œíŒ] ì•Œë¦¼ê¸°ëŠ¥ SSE(Server-Sent Events) ì ìš©"
categories: Project
tag : [Spring, project, board]
author_profile: true
---

ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}

## SSE(Server-Sent Events) ì ìš©í•˜ê¸°

ê²Œì‹œíŒ ë§Œë“¤ë‹¤ê°€ ì•Œë¦¼ ê¸°ëŠ¥ì€ ì–´ë–»ê²Œ êµ¬í˜„í• ê¹Œ í•˜ê³  ì°¾ì•„ë´¤ëŠ”ë° spring ì—ì„œ ì§€ì›í•´ì£¼ëŠ” SseEmitter í´ë˜ìŠ¤ê°€ ìˆì–´ì„œ ì•Œì•„ë³´ì•˜ë‹¤.  



### SSEë€?

- ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ë²•
- ì‹¤ì‹œê°„ ì•Œë¦¼ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ”ë° ìœ ìš©í•œ ê¸°ìˆ 
- ìŠ¤í”„ë§ë¶€íŠ¸ 4.2 ì´ìƒ ë²„ì „ë¶€í„° SseEmitter í´ë˜ìŠ¤ë¥¼ ì§€ì›í•œë‹¤
- SseEmitter í´ë˜ìŠ¤ëŠ” Spring MVCì˜ ì¼ë¶€ë¡œ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë‹¨ë°©í–¥ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•´ì£¼ë©° í´ë¼ì´ì–¸íŠ¸ëŠ” EventSource APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì—ì„œ ë³´ë‚¸ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

### SseEmitter í´ë˜ìŠ¤ ì£¼ìš” ê¸°ëŠ¥ê³¼ ë©”ì„œë“œ

1. ìƒì„±ì
    - SseEmitter() : ê¸°ë³¸ ìƒì„±ì, íƒ€ì„ ì•„ì›ƒ ì„¤ì • ì—†ì´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    - SseEmitter(Long timeout) : ì§€ì •ëœ íƒ€ì„ì•„ì›ƒì„ ê°€ì§„ SseEmitter ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±
2. ì£¼ìš” ë©”ì„œë“œ
    - **send(Object object)** : ë‹¨ì¼ ê°ì²´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ ë°ì´í„°ë¥¼ ê¸°ë³¸ ì´ë²¤íŠ¸ë¡œ ìˆ˜ì‹ í•œë‹¤.
    - **send(SseEmitter.SseEventBuilder event)** : ì´ë²¤íŠ¸ ë¹Œë”ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ë²¤íŠ¸ë¥¼ ì„¸ë°€í•˜ê²Œ ì„¤ì •í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•œë‹¤. ì´ë²¤íŠ¸ ì´ë¦„/ ë°ì´í„° / ID ë“±ì„ ì„¤ì • í•  ìˆ˜ ìˆë‹¤.
    - **complete( )** : SSE ìŠ¤íŠ¸ë¦¼ì„ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œí•œë‹¤, í´ë¼ì´ì–¸íŠ¸ì—ê²Œ EOF(End Of File)ë¥¼ ì „ì†¡í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ ë‹«ëŠ”ë‹¤.
    - **completeWithError(Throwable ex)** : ì§€ì •ëœ ì—ëŸ¬ì™€ í•¨ê»˜ SSE ìŠ¤íŠ¸ë¦¼ì„ ì™„ë£Œí•œë‹¤. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì—ëŸ¬ë¥¼ ì „ì†¡í•˜ê³  ìŠ¤íŠ¸ë¦¼ì„ ë‹«ëŠ”ë‹¤.
    - **onCompletion(Runnable callback)** : ìŠ¤íŠ¸ë¦¼ì´ íƒ€ì„ì•„ì›ƒ ë˜ì—ˆì„ ë•Œ ì‹¤í–‰í•  ì½œë°±ì„ ì„¤ì •í•œë‹¤.
    - **onTimeout(Runnable callback)** : ìŠ¤íŠ¸ë¦¼ì´ íƒ€ì„ì•„ì›ƒë˜ì—ˆì„ ë•Œ ì‹¤í–‰í•  ì½œë°±ì„ ì„¤ì •í•œë‹¤.
    - **setTimeout(Long timeout)** : íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•œë‹¤.
3. í™œìš© ë°©ë²•
    
    SseEmitter í´ë˜ìŠ¤ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‘¸ì‹œí•´ì•¼ í•˜ëŠ” ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìœ ìš©í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜, ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ, ë¼ì´ë¸Œ í”¼ë“œ ì—…ë°ì´íŠ¸ ë“±ì„ êµ¬í˜„í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  SseEmitterë¥¼ ì‚¬ìš©í•˜ë©´ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆì–´, í´ë¼ì´ì–¸íŠ¸ëŠ” ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë°›ì•„ë³¼ ìˆ˜ ìˆë‹¤.
    

### ì ìš© ë°©ë²•

1. í´ë¼ì´ì–¸íŠ¸ â†’  ì„œë²„ : ì•Œë¦¼ìš”ì²­
    
    ```jsx
    const eventSource = new EventSource('/notifications');
    ```
    
2. ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸ : ì—°ê²° ì„¤ì • ë° ë©”ì„¸ì§€ ë³´ë‚´ê¸°
    
    ```java
    // ì—°ê²° ì„¤ì •
    
    @GetMapping("/notifications")
    public SseEmitter subscribe() {
        SseEmitter sseEmitter = new SseEmitter(3600000L); // 1ì‹œê°„ ë™ì•ˆ ì—°ê²° ìœ ì§€
        // ì—°ê²°ì´ ì¢…ë£Œë˜ë©´ ì œê±°
        sseEmitter.onCompletion(() -> emitterRepository.delete(userId));
        sseEmitter.onTimeout(() -> emitterRepository.delete(userId));
        return sseEmitter;
    }
    
    // ë©”ì„¸ì§€ ë³´ë‚´ê¸°
    
    private void sendNotification(String message, String username) {
        notificationService.getEmittersForUser(username).forEach(emitter -> {
            try {
                emitter.send(SseEmitter.event().name("notification").data(message));
            } catch (IOException e) {
                emitter.completeWithError(e);
            }
        });
    }
    
    ```
    
3. í´ë¼ì´ì–¸íŠ¸ê°€ ë©”ì„¸ì§€ ë°›ê¸°
    
    ```jsx
    eventSource.addEventListener('notification', function(event) {
        const newElement = document.createElement("li");
        newElement.textContent = event.data;
        document.getElementById("notifications").appendChild(newElement);
    });
    ```
    

## SseEmitter ì™¸ ë‹¤ë¥¸ ì•Œë¦¼ ê¸°ëŠ¥

## WebSocket

- **ì¥ì **: ì–‘ë°©í–¥ í†µì‹  ê°€ëŠ¥, ì‹¤ì‹œê°„ ë°ì´í„° ì „ì†¡ì— ì í•©
- **ë‹¨ì **: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ WebSocketì„ ì§€ì›í•´ì•¼ í•¨
- ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜, ì‹¤ì‹œê°„ ê²Œì„, ì£¼ì‹ ì‹œì„¸ ë“± ì‹¤ì‹œê°„ ë°ì´í„° ì „ì†¡ì´ í•„ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©

### ì ìš©ë°©ë²•

1. ì˜ì¡´ì„± ì¶”ê°€
    
    ```java
    dependencies {
        implementation 'org.springframework.boot:spring-boot-starter-websocket'
    }
    ```
    
2. WebSocket ì„¤ì •
    
    ```java
    import org.springframework.context.annotation.Configuration;
    import org.springframework.web.socket.config.annotation.EnableWebSocket;
    import org.springframework.web.socket.config.annotation.WebSocketConfigurer;
    import org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;
    
    @Configuration
    @EnableWebSocket
    public class WebSocketConfig implements WebSocketConfigurer {
        @Override
        public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
            registry.addHandler(new NotificationHandler(), "/notifications").setAllowedOrigins("*");
        }
    }
    
    ```
    
3. WebSocket í•¸ë“¤ëŸ¬
    
    ```java
    import org.springframework.web.socket.TextMessage;
    import org.springframework.web.socket.WebSocketSession;
    import org.springframework.web.socket.handler.TextWebSocketHandler;
    
    public class NotificationHandler extends TextWebSocketHandler {
        @Override
        protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {
            // ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§
            session.sendMessage(new TextMessage("New notification!"));
        }
    }
    
    ```
    

## Long Polling

- í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ëŠ” ìƒˆë¡œìš´ ë°ì´í„°ê°€ ìˆì„ ë•Œê¹Œì§€ ì‘ë‹µì„ ì§€ì—°ì‹œí‚¤ëŠ” ë°©ì‹
- ë°ì´í„°ê°€ ì¤€ë¹„ë˜ë©´ ì„œë²„ëŠ” ì‘ë‹µì„ ë³´ë‚´ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤
- WebSocketì´ë‚˜ SSEë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì¥ì **: ë¹„êµì  êµ¬í˜„ì´ ê°„ë‹¨, ëª¨ë“  ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›
- **ë‹¨ì **: ì„œë²„ ë¦¬ì†ŒìŠ¤ ì†Œëª¨ê°€ í¼, ì§€ì—° ì‹œê°„ì´ ìˆì„ ìˆ˜ ìˆìŒ

### ì ìš©ë°©ë²•

```java
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class NotificationController {
    @GetMapping("/notifications")
    public DeferredResult<String> getNotifications() {
        DeferredResult<String> deferredResult = new DeferredResult<>(30000L);
        new Thread(() -> {
            try {
                Thread.sleep(10000); // ì˜ˆì‹œë¡œ 10ì´ˆ ëŒ€ê¸°
                deferredResult.setResult("New notification!");
            } catch (InterruptedException e) {
                deferredResult.setErrorResult(e);
            }
        }).start();
        return deferredResult;
    }
}

```

## Push Notifications

ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë§ì´ ì‚¬ìš©

ì„œë²„ëŠ” í‘¸ì‹œ ì„œë¹„ìŠ¤(APNs, FCM ë“±)ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‘¸ì‹œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ë‹¤.

- **ì¥ì **: ëª¨ë°”ì¼ ë° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‘ì— ì í•©, ì‚¬ìš©ìê°€ ì•±ì„ ì‚¬ìš© ì¤‘ì´ì§€ ì•Šì„ ë•Œë„ ì•Œë¦¼ ì „ì†¡ ê°€ëŠ¥
- **ë‹¨ì **: ì„¤ì •ì´ ë³µì¡í•  ìˆ˜ ìˆìŒ, ë¸Œë¼ìš°ì € í‘¸ì‹œ ì§€ì› í•„ìš”

### ì ìš© ë°©ë²•

1. ì˜ì¡´ì„± ì¶”ê°€
    
    ```java
    dependencies {
        implementation 'nl.martijndwars:web-push:5.1.0'
    }
    ```
    
2. Controller
    
    ```java
    import nl.martijndwars.webpush.Notification;
    import nl.martijndwars.webpush.PushService;
    import org.springframework.web.bind.annotation.PostMapping;
    import org.springframework.web.bind.annotation.RequestBody;
    import org.springframework.web.bind.annotation.RestController;
    
    @RestController
    public class NotificationController {
        private PushService pushService = new PushService();
    
        @PostMapping("/sendNotification")
        public void sendNotification(@RequestBody Subscription subscription) throws Exception {
            Notification notification = new Notification(subscription, "New notification!");
            pushService.send(notification);
        }
    }
    
    ```