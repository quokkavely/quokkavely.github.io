---
layout : single
title : "JDBC-2 ì¶”ê°€êµ¬í˜„ +@Builder"
categories: Spring
tag : [Spring, ê°œë…ì •ë¦¬]
author_profile: true
---

ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}

# DTO ìˆ˜ì •í•˜ê¸° 
### ë³´ì™„í•˜ê¸° â†’ **URIë¥¼ í—¤ë”ì— ì¶”ê°€í•´ì„œ ì „ë‹¬ / ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ ì£¼ë¬¸ë„ ì‘ë‹µ**í•  ìˆ˜ ìˆê²Œ í•˜ê¸°!

## POST

- í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ì˜ ë“±ë¡ì„ ìš”ì²­í•  ê²½ìš° , í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ DBì— ì €ì¥í•œ í›„ ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŒì„ 201 Created HTTP Statusë¥¼ response headerì— ì¶”ê°€í•´ì„œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— ì‘ë‹µìœ¼ë¡œ ì „ë‹¬
- ê±°ê¸°ì— ë”í•´  DBì— ì €ì¥ëœ ë¦¬ì†ŒìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ëŠ” ìœ„ì¹˜ ì •ë³´(Location)ì¸ URIë¥¼ ì—­ì‹œ response headerì— ì¶”ê°€í•´ì„œ ì‘ë‹µìœ¼ë¡œ ì „ë‹¬
  
    <imgs scr="" width=500/>
    
    - ì°¸ê³ ë¡œ â­ ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸¡ì— ë¦¬ì†ŒìŠ¤ë¥¼ ë“±ë¡í•  ê²½ìš°ì—ëŠ” ë“±ë¡ëœ ë¦¬ì†ŒìŠ¤ì˜ ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ë¦¬í„´í•  í•„ìš”ê°€ ì—†ìŒ

### ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ ì£¼ë¬¸ê³¼ ì‘ë‹µ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸°

1. ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ë¥¼ ì£¼ë¬¸í•  ìˆ˜ ìˆê²Œ í•˜ê¸° - **OrderPostDto** ìˆ˜ì •
   
    ```java
    //ê¸°ì¡´ ì½”ë“œ
    package com.springboot.order.dto;
    
    import javax.validation.constraints.Positive;
    
    @Getter
    @Setter
    public class OrderPostDto {
        @Positive
        private long memberId;
    
        @Positive
        private long coffeeId; //ë³€ê²½í•  ë¶€ë¶„
    }
    ```
    
    - ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ë¥¼ ì£¼ë¬¸í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•´ì•¼ í•¨.
      
        ```java
        @Valid
        private List<OrderCoffeeDto> ordercoffees;
        ```
        
    
2. ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ë¥¼ ì£¼ë¬¸í•˜ê¸° ìœ„í•´ ì¶”ê°€ - **OrderCoffeeDto**
   
    ```java
    @Getter
    @AllArgsConstructor
    public class OrderCoffeeDto {
        @Positive
        private long coffeeId;
    
        @Positive
        private int quantity;
    }
    
    ```
    
3. ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ì œê³µí•˜ê¸° ìœ„í•´ ì¶”ê°€ - **OrderCoffeeResponseDto**
   
    ```java
    @Getter
    @AllArgsConstructor
    public class OrderCoffeeResponseDto {
        private long coffeeId;
        private String korName;
        private String engName;
        private int price;
        private int quantity;
    }
    
    ```
    
     
    
4. ì£¼ë¬¸í•œ ì—¬ëŸ¬ ê±´ì˜ ì»¤í”¼ ì •ë³´ë¥¼ ì‘ë‹µí•˜ê¸° ìœ„í•´ ìˆ˜ì • -  **OrderResponseDto**
   
    ```java
    package com.springboot.order.dto;
    
    import lombok.AllArgsConstructor;
    import lombok.Getter;
    import lombok.Setter;
    
    @Getter
    @Setter
    @AllArgsConstructor
    public class OrderResponseDto {
        private long memberId;
        private long coffeeId;
    }
    ```
    
    - ì—¬ëŸ¬ ì”ì˜ ì»¤í”¼ ì •ë³´ë¥¼ ì‘ë‹µìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆê²Œ ë³€ê²½ +  ì£¼ë¬¸ ì‹œê°„ê³¼ ì£¼ë¬¸ ìƒíƒœë„ ì‘ë‹µìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´ ì•„ë˜ ì½”ë“œ ì¶”ê°€.
      
        ```java
          private Order.OrderStatus orderStatus;
          private List<OrderCoffeeResponseDto> orderCoffees;
          private LocalDateTime createdAt;
        ```
        
    
5. **OrderMapper** ìˆ˜ì • â†’ ë§¤í•‘ ì‘ì—…ì´ ë³µì¡í•˜ì—¬ ì§ì ‘ ë§¤í•‘ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
    - OrderPostDto â†’ Orderë¡œ ë³€ê²½
      
        ```java
        default Order orderPostDtoToOrder(OrderPostDto orderPostDto) {
           Order order = new Order();
        	   // (1)
        	 order.setMemberId(orderPostDto.getMemberId());
        
             // (2)
           Set<OrderCoffee> orderCoffees = orderPostDto.getOrderCoffees()
                        .stream()
                        .map(orderCoffeeDto ->
                                // (3)
                              OrderCoffee.builder()
                              .coffeeId(orderCoffeeDto.getCoffeeId())
        	                    .quantity(orderCoffeeDto.getQuantity())
                              .build())
        	               .collect(Collectors.toSet());
        				    order.setOrderCoffees(orderCoffees);
                
                return order;
            }
        ```
        
        (1)  : OrderPostDtoì— í¬í•¨ëœ memberIdë¥¼ Orderì— ë“±ë¡
        
        (2) : OrderPostDtoì— ì£¼ë¬¸ëœ ì»¤í”¼ ì •ë³´- List<OrderCoffeeDto> â‡’
        
        Order í´ë˜ìŠ¤ì˜ Set<OrderCoffee>orderCoffeesë¡œ ë³€í™˜ 
        
    - Set<OrderCoffee> â†’ List<OrderCoffeeResponseDto>ë¡œ ë³€ê²½ í•˜ëŠ” ë¡œì§ í•„ìš”
      
        ```java
        default List<OrderCoffeeResponseDto> orderCoffeesToOrderCoffeeResponseDtos
        							(CoffeeService coffeeService,Set<OrderCoffee> orderCoffees){
            // (1)
           return orderCoffees.stream()
        				    .map(orderCoffee -> {
                       // (2)
               Coffee coffee = coffeeService.findCoffee(orderCoffee.getCoffeeId());
               
                     return new OrderCoffeeResponseDto(coffee.getCoffeeId(),
                                coffee.getKorName(),
                                coffee.getEngName(),
                                coffee.getPrice(),
                                orderCoffee.getQuantity());
        			             }).collect(Collectors.toList());
            }
        }
        
        ```
        
        âœ”ï¸ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì»¤í”¼ì˜ êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ì¡°íšŒí•œ í›„, `OrderCoffeeResponseDto`ì— ì»¤í”¼ ì •ë³´ë¥¼ ì±„ì›Œ ë„£ëŠ” ì—­í• 
        
        (1) orderCoffeesì—ì„œ streamí†µí•´ Coffeeë¥¼ ì¡°íšŒí•œ í›„ CoffeeResponseDtoë¡œ ë³€í™˜í•¨
        
        (2) íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ë“¤ì–´ì˜¨ coffeeServiceë¡œ coffeeId ì— í•´ë‹¹í•˜ëŠ” ì»¤í”¼ë¥¼ ì¡°íšŒ
        
    - Order (with CoffeeService)â†’ OrderResposeDto ë¡œ ë³€ê²½
      
        ```java
        default OrderResponseDto orderToOrderResponseDto
        								(CoffeeService coffeeService,Order order){
            // (1)
            long memberId = order.getMemberId();
        
            // (2)
            List<OrderCoffeeResponseDto> orderCoffees =
                orderCoffeesToOrderCoffeeResponseDtos
        									(coffeeService, order.getOrderCoffees());
        
                OrderResponseDto orderResponseDto = new OrderResponseDto();
                orderResponseDto.setOrderCoffees(orderCoffees);
                orderResponseDto.setMemberId(memberId);
                orderResponseDto.setCreatedAt(order.getCreatedAt());
                orderResponseDto.setOrderId(order.getOrderId());
                orderResponseDto.setOrderStatus(order.getOrderStatus());
                
            return orderResponseDto;
         }
        ```
        
### OrderCotrollerì˜ Postì— url ì¶”ê°€

 ```java
    @RestController
    @RequestMapping("/v10/orders")
    @Validated
    public class OrderController {
        private final static String ORDER_DEFAULT_URL = "/v10/orders"; // (1) Default URL ê²½ë¡œ
        private final OrderService orderService;
        private final OrderMapper mapper;
        private final CoffeeService coffeeService;
    
        public OrderController(OrderService orderService,
                               OrderMapper mapper,
                               CoffeeService coffeeService) {
            this.orderService = orderService;
            this.mapper = mapper;
            this.coffeeService = coffeeService;
        }
    
        @PostMapping
        public ResponseEntity postOrder(@Valid @RequestBody OrderPostDto orderPostDto) {
            Order order = orderService.createOrder(mapper.orderPostDtoToOrder(orderPostDto));
    
            // (2) ë“±ë¡ëœ ì£¼ë¬¸(Resource)ì— í•´ë‹¹í•˜ëŠ” URI ê°ì²´
            URI location =
                    UriComponentsBuilder
                            .newInstance()
                            .path(ORDER_DEFAULT_URL + "/{order-id}")
                            .buildAndExpand(order.getOrderId())
                            .toUri();               // "/v10/orders/{order-id}"
    
            return ResponseEntity.created(location).build(); // (3) HTTP 201 Created status
        }
 ```

    <imgs scr="" width=500/>


### @Builder

1. @Builder 

    í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•˜ëŠ” ë° í•„ìš”í•œ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±

    ```java
    Person.builder()
    .name("Adam Savage")
    .city("San Francisco")
    .job("Mythbusters")
    .job("Unchained Reaction")
    .build();
    ```

    https://projectlombok.org/features/Builder ì°¸ê³ .

    

2. ìƒì„±ìì™€ Builder

    1. ìƒì„±ìëŠ” íŒŒë¼ë¯¸í„° ì—†ìœ¼ë©´ ì—ëŸ¬. +ìœ„ì¹˜ë„ ë§ì¶°ì•¼ í•¨
    2. ë¹Œë”ëŠ” íŒŒë¼ë¯¸í„°ì— ì—†ì–´ë„ ì•Œì•„ì„œ ì´ˆê¸°í™” í•¨. ì•Œì•„ì„œ ìœ„ì¹˜ë„ ë§ì¶¤. 
       
        â†’ SetterëŠ” ì–¸ì œë“ ì§€ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ - ë³€ê²½ì˜ ì—¬ì§€ê°€ ê³„ì† ì—´ë¦¬ì§€ë§Œ BuilderëŠ” ìƒì„±ìì²˜ëŸ¼ ë§Œë“¤ì–´ì§ˆ ë•Œ í•œë²ˆë°–ì— ëª» ì”€
        
    3. ì´ê±´ íšŒì‚¬ë§ˆë‹¤ ë§ì¶°ì„œ ì‚¬ìš©í•˜ë©´ ë¨ â†’ ì‹¤ë¬´ë‚˜ê°€ë©´ ë¹Œë” ì—„ì²­ ë§ì´ ì“°ê³  ìƒì„±ìì™€ í˜¼ìš©í•´ì„œ ì”€
    4. í”„ë¡œê·¸ë¨ ë§Œë“¤ë©´ ì»¤í”¼ì´ë¯¸ì§€ë‚˜ ì´ëŸ°ê±° ë³´ë‚´ì•¼ ë˜ëŠ”ë° ì´ëŸ´ ë• ë¹Œë”ê°€ í¸í•¨.
    5. builderëŠ” êµ¬í˜„í•˜ê¸° ê¹Œë‹¤ë¡œìš´ë°  ë¡¬ë³µì— @Builder ì‘ì„±í•˜ë©´ í¸í•˜ê²Œ ì“¸ ìˆ˜ ìˆìŒ â‡’ ê·¸ë˜ë„ êµ¬í˜„í•  ì¤„ ì•Œì•„ì•¼ í•¨