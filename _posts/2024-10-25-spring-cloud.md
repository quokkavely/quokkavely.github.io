---
layout : single
title : "[MSA] chapter 1.9_Spring cloud"
categories: MSA
tag : [MSA, SpringCloud]
author_profile: true
---

📌 개인적인 공간으로 공부를 기록하고 복습하기 위해 사용하는 블로그입니다. <br>
정확하지 않은 정보가 있을 수 있으니 참고바랍니다 :😸 <br>
[틀린 내용은 댓글로 남겨주시면 복받으실거에요]  
{: .notice--primary}

인프런 Dowon Lee님의 Spring Cloud로 개발하는 마이크로서비스 애플리케이션(MSA) 강의를 듣고 정리한 필기입니다.😊<br>
[Spring Cloud로 개발하는 마이크로서비스 애플리케이션(MSA) 강의 들으러 가기👩‍🏫](https://inf.run/GHeRm)
{: .notice--warning}

## 엔터프라이즈 애플리케이션의 변화와 MSA 지원 프레임워크

2017년 가트너(Gartner)는 새로운 엔터프라이즈 Java 애플리케이션의 70% 이상이 기존의 단일 웹서버나 앱 서버에서 작동하지 않고, 독립적인 클라우드 및 마이크로서비스 형태로 개발될 것이라고 발표했다. 이와 같이 마이크로서비스 아키텍처의 수요가 증가하면서 독립적이고 유연하게 확장 가능한 애플리케이션 개발을 위한 다양한 프레임워크가 등장했다. 대표적인 MSA 지원 프레임워크가 **Spring Cloud**이며, Spring Cloud는 MSA에서 필요한 다양한 기능을 지원한다.

---

### Spring Cloud의 주요 기능 및 구성 요소

Spring Cloud는 **Spring Boot**와 연계하여 다양한 마이크로서비스 환경에서 애플리케이션을 구성할 수 있도록 한다. 각 버전은 상호 호환성을 고려해 사용되며, 현재 Spring Boot 버전 2.2, 2.3과 함께 **Spring Cloud Hoxton**을, 버전 2.4에서는 최신 Spring Cloud 버전을 사용한다.

<img src ="https://github.com/user-attachments/assets/3df98551-7905-48ea-81a7-2514bb391e86" width =500/>

### 1. 환경 설정 관리: Spring Cloud Config

- **Spring Cloud Config Server**: 마이크로서비스에서 공통으로 사용하는 환경 설정 정보를 외부에 저장하고 관리하는 서버다. 예를 들어, API Gateway IP나 인증 토큰 등의 정보를 한 곳에 모아두고, 서비스 간 참조하도록 하여 변경 시에도 별도의 배포 없이 즉시 반영되도록 지원한다. 이를 통해 유지보수를 훨씬 간편하게 한다.

<img src ="https://github.com/user-attachments/assets/1428f1ad-365b-40a9-bacc-fa10c98f4689" width=500/>

### 2. 서비스 디스커버리와 로드 밸런싱: Eureka와 Gateway

1. **Eureka Server**
    - 각 마이크로서비스의 위치 정보를 등록하고 검색할 수 있도록 도와주는 서비스.
    - 서비스 간 상호 참조가 필요할 때, Eureka에 등록된 정보를 활용해 위치를 검색한다.
    - **작동 방식**
        - **서비스 등록**: 각 마이크로서비스는 Eureka 서버에 자신의 위치를 주기적으로 등록해, 등록된 상태를 최신으로 유지한다.
        - **서비스 검색**: 다른 마이크로서비스에서 요청이 들어올 때 Eureka 서버에서 위치를 조회해 연결한다.
2. **Spring Cloud Gateway**
    - 클라이언트 요청을 각 마이크로서비스로 라우팅해주는 API 게이트웨이 역할을 수행하며, 로드 밸런싱을 통해 트래픽을 분산시킨다.
    - 모든 트래픽이 게이트웨이를 통해 관리되므로 보안과 인증을 중앙에서 제어할 수 있다.
    - 최신 Spring Cloud 버전에서는 기존의 Ribbon 대신 Gateway를 권장한다.
    - **구성 요소**
        - **Route**: 클라이언트의 요청 경로를 정의해 요청을 라우팅한다.
        - **Filter**: 요청에 대한 전후처리 로직을 설정해 보안, 로깅, 로드 밸런싱 등의 처리를 추가할 수 있다.

### 3. 서비스 간 통신: REST Template와 Feign Client

마이크로서비스 간 데이터 통신을 위해 **REST Template** 또는 **Feign Client**를 사용한다.

- **Feign Client**:
    - **기능**: 인터페이스 선언만으로 REST API 호출이 가능하며, 구현체를 자동으로 생성해준다.
    - **장점**: 코드가 간결해지고 유지보수가 쉬워진다.
    - **사용 예**: `@FeignClient` 어노테이션을 통해 마이크로서비스 간 통신을 설정할 수 있다.
- **RestTemplate**:
    - **기능**: Spring에서 제공하는 HTTP 통신 라이브러리로, 직접적으로 REST API 호출을 코드로 구현할 수 있다.
    - **특징**: Feign보다 유연하게 커스터마이징이 가능하지만, 코드가 많아지고 복잡해질 수 있다.

### 4. 모니터링과 시각화: Zipkin과 ELK Stack

1. **Spring Cloud Sleuth**
    - **기능**: 서비스 간 호출 시 고유한 트레이싱 ID를 생성하여 요청 흐름을 추적할 수 있도록 한다. 로그마다 트레이싱 ID가 기록되기 때문에 어떤 요청이 어디서 발생했는지 추적하기 쉽다.
2. **Zipkin**
    - **기능**: Sleuth와 함께 분산 추적 시스템을 구성하며, 각 서비스의 호출 정보를 시각적으로 분석하고 모니터링할 수 있다.
    - **구조**: 각 마이크로서비스의 요청 정보를 Zipkin 서버로 전송하고, Zipkin은 이를 시각적으로 분석하여 각 요청의 호출 관계와 지연 시간 등을 보여준다.
3. **ELK Stack**: Elasticsearch, Logstash, Kibana로 구성된 스택을 통해 로그를 수집하고 시각화해, 시스템 상태와 성능을 모니터링할 수 있다.

### 5. 장애 회복성: Hystrix

- **Hystrix**: 넷플릭스의 장애 회복성 패턴 구현체로, 서비스 간 통신 중 장애가 발생했을 때 빠르게 복구할 수 있는 회복 기능을 제공한다. 서킷 브레이커(Circuit Breaker) 패턴을 통해 문제가 생긴 서비스로의 요청을 제한하고, 대체 로직을 수행하도록 한다.
    - **기능**: 서비스 간 장애 발생 시 요청을 제한해 서비스 전체에 영향을 미치는 것을 방지하는 서킷 브레이커 패턴을 구현한다.
    - **작동 방식**:
        - **서킷 열림(Open)**: 장애가 일정 횟수 이상 발생하면 서킷이 열리고, 해당 서비스로의 요청을 차단한다.
        - **서킷 닫힘(Close)**: 시간이 지나 서킷이 닫히면 정상 요청을 재개해 시스템이 복구되었는지 확인한다.
        - **Fallback 메커니즘**: 특정 서비스가 응답하지 않으면 대체 로직을 수행하도록 하여 사용자 경험을 유지한다.
    - **장점**: 마이크로서비스 환경에서 개별 서비스 오류가 전체 시스템으로 전파되지 않도록 보호한

---

### 요약 🪄

가트너의 예측처럼, MSA와 클라우드가 주도하는 환경에서 Spring Cloud는 마이크로서비스 아키텍처를 구현하는 필수 구성 요소와 기능을 지원한다. Spring Boot와 함께 사용하여 환경 설정 관리, 서비스 디스커버리, 로드 밸런싱, 서비스 간 통신, 모니터링, 장애 회복성을 손쉽게 설정할 수 있으며, 이를 통해 유지보수성과 유연성이 뛰어난 분산 시스템을 구축할 수 있다.

<br>
<br>
<br>
<br>
<br>
