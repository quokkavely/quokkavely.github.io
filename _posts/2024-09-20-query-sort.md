---
layout : single
title : "[Project] QueryDSL ë¬¸ë²• ì •ë¦¬ ë° Sorting ë¬¸ì œ í•´ê²°"
categories: Project
tag : [project2, practice]
author_profile: true
---

ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}

---

## QueryDSL ë¬¸ë²• ì •ë¦¬ ë° Sorting ë¬¸ì œ í•´ê²°

ì „ì²´ ë°±ì—”ë“œ ì½”ë“œ ìˆ˜ì •í•˜ë©´ì„œ ê²€ìƒ‰ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê³³ì—ëŠ” ëª¨ë‘ QueryDSLë¡œ ë³€ê²½í•˜ê¸°ë¡œ í–ˆë‹¤. <br> ìˆ˜ì •í•˜ë©´ì„œë„ ìì£¼ ì‚¬ìš©í•˜ëŠ” eq ì •ë„ë‘ fetchë§Œ ì•Œê³  ìˆì—ˆëŠ”ë° containsIgnoreCase() ì•Œê²Œë˜ë©´ì„œ <br> ë‹¤ìŒì— ì‚¬ìš©í•  ë•Œ ì¡°ê¸ˆ ë” ìœ ìš©í•˜ê±°ë‚˜ ê¸°ë³¸ì ì¸ ë¬¸ë²•ë“¤ì€ ì•Œê³  ë„˜ì–´ê°€ì•¼ê² ë‹¤ ìƒê°í•´ì„œ ì •ë¦¬í•´ë³´ì•˜ë‹¤.

### 1. QueryDSL ê¸°ë³¸ ë¬¸ë²•

1. ì¡°ê±´ ë©”ì„œë“œ
    - **`eq()`**: `=` ì—°ì‚° (Equal)
    - **`ne()`**: `!=` ì—°ì‚° (Not Equal)
    - **`not()`**: í•´ë‹¹ ì¡°ê±´ì„ ë¶€ì •
    - **`isNotNull()`**: `IS NOT NULL` ì—°ì‚°
    - **`in()`**: `IN` ì—°ì‚°
    - **`notIn()`**: `NOT IN` ì—°ì‚°
    - **`between(a,b)`**: `BETWEEN a AND b` ì—°ì‚°
    - **`goe()`**: `>=` ì—°ì‚° (Greater or Equal)
    - **`gt()`**: `>` ì—°ì‚° (Greater Than)
    - **`loe()`**: `<=` ì—°ì‚° (Less or Equal)
    - **`lt()`**: `<` ì—°ì‚° (Less Than)
    - **`like()`**: SQLì˜ `LIKE` ì—°ì‚°. `%`ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.
    - **`contains()`**: ì–‘ìª½ì— `%`ê°€ ìë™ìœ¼ë¡œ ì¶”ê°€ëœ **LIKE** ì—°ì‚°.
    - **`startsWith()`**: ë’¤ì— `%`ê°€ ì¶”ê°€ëœ **LIKE** ì—°ì‚°.
    - **`containsIgnoreCase()`**: ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ í¬í•¨ëœ ë‹¨ì–´ ê²€ìƒ‰.
    - **`likeIgnoreCase()`**: ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ **LIKE** ì—°ì‚°.
2. ë°ì´í„° ì¡°íšŒ ë©”ì„œë“œ
    - **`fetch()`**: ì—¬ëŸ¬ ê±´ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ê³ , ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸(`[]`)ë¥¼ ë°˜í™˜
    - **`fetchOne()`**: ì •í™•íˆ í•œ ê±´ì˜ ê²°ê³¼ë¥¼ ê¸°ëŒ€í•  ë•Œ ì‚¬ìš©. ê²°ê³¼ê°€ ì—†ê±°ë‚˜ ë‘ ê°œ ì´ìƒì¼ ê²½ìš° ì˜ˆì™¸ê°€ ë°œìƒ.
    - **`fetchFirst()`**: ì—¬ëŸ¬ ê²°ê³¼ ì¤‘ì—ì„œ **ê°€ì¥ ì²« ë²ˆì§¸ ê²°ê³¼**ë§Œ ê°€ì ¸ì˜¨. ê²°ê³¼ê°€ ì—†ìœ¼ë©´ `null`ì„ ë°˜í™˜. ë‚´ë¶€ì ìœ¼ë¡œ `limit 1`ì„ ì¶”ê°€í•œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.
    - **`fetchResults()`**: **í˜ì´ì§• ì²˜ë¦¬**ë¥¼ í¬í•¨í•œ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©. **ì´ ê°œìˆ˜**ë¥¼ êµ¬í•˜ëŠ” **count ì¿¼ë¦¬**ê°€ ì¶”ê°€ë¡œ ì‹¤í–‰ëœë‹¤. **QueryResults** ê°ì²´ë¡œ ê²°ê³¼ë¥¼ ë¦¬í„´í•˜ë©°, **í˜ì´ì§• ì •ë³´**ì™€ **ì‹¤ì œ ë°ì´í„°**ë¥¼ í•¨ê»˜ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
        - **`getTotal()`**: ì´ ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
        - **`getLimit()`**: ì¿¼ë¦¬ì—ì„œ ì„¤ì •ëœ limit ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
        - **`getOffset()`**: ì¿¼ë¦¬ì—ì„œ ì„¤ì •ëœ offset ê°’ì„ ê°€ì ¸ì˜¨ë‹¤. (0ë¶€í„° ì‹œì‘)
        - **`getResults()`**: fetch()ì²˜ëŸ¼ ì‹¤ì œ ë°ì´í„°ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë¦¬í„´í•œë‹¤.
    - **`fetchCount()`**:ì¿¼ë¦¬ ì¡°ê±´ì— ë§ëŠ” **ì „ì²´ ë ˆì½”ë“œ ìˆ˜ë¥¼ ë°˜í™˜**í•  ë•Œ ì‚¬ìš©, ë°ì´í„° ìì²´ê°€ ì•„ë‹ˆë¼, **ëª‡ ê°œì˜ ê²°ê³¼**ê°€ ìˆëŠ”ì§€ë§Œ í™•ì¸í•  ë•Œ ìœ ìš©

### 2. Pagination ë° Sorting êµ¬í˜„

í”„ë¡œì íŠ¸ì—ì„œ ê¸°ì¡´ì— ì˜ ë™ì‘í•˜ë˜ ì •ë ¬ ê¸°ëŠ¥ì´ **QueryDSL**ë¡œ ë³€ê²½í•œ í›„ì— ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

ì •ë ¬ ì œëŒ€ë¡œ ì„¤ì •ë˜ì§€ ì•Šì€ ë¬¸ì œë¼ì„œ ì´ë•ŒëŠ” OrderSpecifierë¥¼ ì‚¬ìš©í•´ ì •ë ¬ ê¸°ì¤€ì„ ëª…í™•í•˜ê²Œ ì •ì˜í•´ì•¼ í•œë‹¤..

### í•´ê²° ë°©ë²•: `OrderSpecifier`ë¥¼ ì‚¬ìš©í•´ ì •ë ¬ ì ìš©

ì •ë ¬ ì¡°ê±´ì„ ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ ì í•œë‹¤ë©´, **`getSortOrder()`** ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ **OrderSpecifier** ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•œ í›„, ì´ë¥¼ orderBy() ì— ì ìš©í•´ì•¼ í•œë‹¤.

1. ì •ë ¬ ë©”ì„œë“œ
    
    ```java
    private List<OrderSpecifier<?>> getSortOrder(Pageable pageable, QItemManufacture itemManufacture) {
        // OrderSpecifier<?> ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•œë‹¤.
        List<OrderSpecifier<?>> orders = new ArrayList<>();
    
        // Pageable ê°ì²´ì—ì„œ Sort ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
        for (Sort.Order order : pageable.getSort()) {
            // PathBuilderëŠ” í•„ë“œì— ëŒ€í•œ ê²½ë¡œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• ì„ í•œë‹¤.
            // itemManufacture ì—”í‹°í‹°ì—ì„œ íƒ€ì…ê³¼ ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ PathBuilderë¥¼ ìƒì„±.
            PathBuilder pathBuilder = new PathBuilder(itemManufacture.getType(), itemManufacture.getMetadata());
    
            // Sort.Order ê°ì²´ê°€ ì˜¤ë¦„ì°¨ìˆœì´ë©´ ASC, ë‚´ë¦¼ì°¨ìˆœì´ë©´ DESCë¡œ OrderSpecifierë¥¼ ì¶”ê°€í•œë‹¤.
            orders.add(new OrderSpecifier(order.isAscending() ? Order.ASC : Order.DESC,
                                          pathBuilder.get(order.getProperty())));
        }
    
        // OrderSpecifier ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜í™˜.
        return orders;
    }
    ```
    
    - **`Pageable`**: ìŠ¤í”„ë§ì—ì„œ í˜ì´ì§•ê³¼ ì •ë ¬ì„ ê´€ë¦¬í•˜ëŠ” ê°ì²´. í˜ì´ì§€ ë²ˆí˜¸, í˜ì´ì§€ í¬ê¸°, ì •ë ¬ ê¸°ì¤€ ë“±ì„ í¬í•¨í•œë‹¤.
    - **`PathBuilder`**: ë™ì ìœ¼ë¡œ **ê²½ë¡œ**ë¥¼ ìƒì„±í•´ì£¼ëŠ” í´ë˜ìŠ¤. ì—¬ê¸°ì„œëŠ” **í•„ë“œëª…**ì„ ë™ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
    - **`OrderSpecifier`**: ì •ë ¬ì„ ìœ„í•œ ê°ì²´ë¡œ, ì˜¤ë¦„ì°¨ìˆœê³¼ ë‚´ë¦¼ì°¨ìˆœì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
2. ì „ì²´ ì½”ë“œ (Sortingê³¼ Pagination ì ìš©)
    
    ```java
    // Sort ì²˜ë¦¬: getSortOrder ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ OrderSpecifier ëª©ë¡ì„ ìƒì„±.
    List<OrderSpecifier<?>> orderSpecifiers = getSortOrder(pageable, itemManufacture);
    
    // QueryDSLë¡œ ë°ì´í„° ì¡°íšŒ
    List<ItemManufacture> results = queryFactory
            .selectFrom(itemManufacture)
            .where(builder)  // ì¡°ê±´ì ˆ ì¶”ê°€
            .orderBy(orderSpecifiers.toArray(new OrderSpecifier[0]))  // OrderSpecifier ë°°ì—´ë¡œ ì •ë ¬ ì¡°ê±´ ì¶”ê°€
            .offset(pageable.getOffset())  // í˜ì´ì§• offset ì„¤ì • , í˜ì´ì§€ì˜ ì‹œì‘ì 
            .limit(pageable.getPageSize())  // í˜ì´ì§• limit ì„¤ì •, ë°ì´í„°ì˜ ê°œìˆ˜
            .fetch();  // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ë¡œ ê°€ì ¸ì˜´
    ```
    
    - **`getSortOrder(pageable, itemManufacture)`**:
        - ìœ„ì—ì„œ ì •ì˜í•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´, **ì •ë ¬ ì¡°ê±´**ì„ ê°€ì ¸ì˜¨ë‹¤.
    - **`orderBy(orderSpecifiers.toArray(new OrderSpecifier[0]))`**:
        - ì •ë ¬ ì¡°ê±´ì„ **OrderSpecifier ë°°ì—´**ë¡œ ë³€í™˜í•˜ì—¬ **orderBy**ì— ì „ë‹¬í•œë‹¤.

.