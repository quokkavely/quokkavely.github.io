---
layout : single
title : "[Testing] Mockito"
categories: Spring
tag : [Spring, ê°œë…, JPA, Testing]
author_profile: true
---


ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}


# Mockito

**âœ… Mock ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤**

<img src = "https://github.com/quokkavely/quokkavely.github.io/assets/165968530/ad6ec580-7d90-4a82-a41b-95047a7f8e21" width = 500/>

**âœ… Mock ê°ì²´ë¥¼ ì‚¬ìš©í•œ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤**

<img src = "https://github.com/quokkavely/quokkavely.github.io/assets/165968530/a039721b-cf2c-4388-9e72-cf851501d6a5" width = 500/>

## Mockitoë€?

- Spring Framework ìì²´ì ìœ¼ë¡œë„ ì§€ì›í•˜ê³  ìˆëŠ” Mocking ë¼ì´ë¸ŒëŸ¬ë¦¬ â†’ **Mockito**
- Mock ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , í•´ë‹¹ Mock ê°ì²´ê°€ ì§„ì§œì²˜ëŸ¼ ë™ì‘í•˜ê²Œ í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹
- Mockitoì˜ Mocking ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ í…ŒìŠ¤íŠ¸í•˜ê³ ì í•˜ëŠ” ëŒ€ìƒì—ì„œ ë‹¤ë¥¸ ì˜ì—­(ë‹¤ë¥¸ ê³„ì¸µ ë˜ëŠ” ì™¸ë¶€ í†µì‹ ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ ë“±)ì„ ë‹¨ì ˆì‹œì¼œ ì˜¤ë¡œì§€ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì—ë§Œ ì§‘ì¤‘ ê°€ëŠ¥

## ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ì— Mockito ì ìš©

```java
@Test
void postMemberTest() throws Exception {
    // given
    //MemberDto.Post ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•  ë°ì´í„°ë¥¼ ì„¤ì •
    MemberDto.Post post = new MemberDto.Post("jerry@gmail.com","ì œë¦¬","010-1111-1111");
    
    // ìƒì„±ëœ MemberDto.Post ê°ì²´ë¥¼ Member ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    Member member = mapper.memberPostToMember(post);
    
	  // ë³€í™˜ëœ Member ê°ì²´ì— IDë¥¼ ì„¤ì •
	  //ì™œëƒë©´ createMemberì—ì„œ Idë¥¼ ë¦¬í„´í•´ì£¼ê³ 
    // Idê°€ responseì—ì„œë„ Location headerì— í¬í•¨ì´ë˜ì–´ì•¼ í•¨
    
    member.setMemberId(1L);

    // memberService.createMember ë©”ì„œë“œê°€ 
    //ì–´ë–¤ Member ê°ì²´ë¥¼ ë°›ë”ë¼ë„ ë¯¸ë¦¬ ì„¤ì •í•œ member ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ mock ì„¤ì •
    given(memberService.createMember(Mockito.any(Member.class)))
            .willReturn(member);

    // post ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
    String content = gson.toJson(post);

    // when ->  /v11/membersì— POST ìš”ì²­ì„ ë³´ë‚´ê¸°
    ResultActions actions = mockMvc.perform(post("/v11/members")
            .accept(MediaType.APPLICATION_JSON) // ì‘ë‹µì„ JSON í˜•ì‹ìœ¼ë¡œ ë°›ê² ë‹¤ëŠ” ì˜ë¯¸.
            .contentType(MediaType.APPLICATION_JSON) // ìš”ì²­ ë³¸ë¬¸ì´ JSON í˜•ì‹ì´ë¼ëŠ” ê²ƒ
            .content(content)); // ìš”ì²­ ë³¸ë¬¸ì— ë³€í™˜ëœ JSON ë¬¸ìì—´ì„ í¬í•¨ì‹œí‚¨ë‹¤.

    // then: ê²°ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ë¶€ë¶„
    actions.andExpect(status().isCreated())
            // ì‘ë‹µ í—¤ë”ì˜ Location ê°’ì´ "/v11/members/"ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸
            .andExpect(header().string("Location", is(startsWith("/v11/members/"))));
}

```

1. **`@MockBean`**
    - Application Contextì— ë“±ë¡ë˜ì–´ ìˆëŠ” Beanì— ëŒ€í•œ Mockito Mock ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì£¼ì…í•´ ì£¼ëŠ” ì—­í• ì„ í•œë‹¤ â†’ `@MockBean` ì• ë„ˆí…Œì´ì…˜ì„ í•„ë“œì— ì¶”ê°€í•˜ë©´ í•´ë‹¹ í•„ë“œì˜ Beanì— ëŒ€í•œ Mock ê°ì²´ë¥¼ ìƒì„±í•œ í›„, í•„ë“œì— ì£¼ì…(DI)í•œë‹¤..
    - ì˜ˆì œ ì½”ë“œì—ì„œëŠ” MemberService ë¹ˆì— ëŒ€í•œ Mock ê°ì²´ë¥¼ ìƒì„±í•´ì„œ memberService í•„ë“œì— ì£¼ì…í•©ë‹ˆë‹¤.
2. **MemberMapper**
    - DI ë°›ëŠ” ì´ìœ ëŠ” MockMemberService(ê°€ì¹­)ì˜ `createMember()`ì—ì„œ ë¦¬í„´í•˜ëŠ” Member ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•¨ â†’ post(MemberDto.Post íƒ€ì…) ë³€ìˆ˜ë¥¼ Member ê°ì²´ë¡œ ë³€í™˜
    - new Member()ì™€ ê°™ì´ Member ê°ì²´ë¥¼ ìƒì„±í•´ë„ ë˜ì§€ë§Œ post ë³€ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ MemberMapperë¡œ ë³€í™˜ í•¨.
    - ì‹¤ì œ createMember()ì˜ ë¦¬í„´ ê°’(Member ê°ì²´)ì—ëŠ” memberIdê°€ í¬í•¨ì´ ë˜ëŠ”ë° ì´ memberIdëŠ” **responseì˜ Location headerì— í¬í•¨ì´ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ** MockMemberService(ê°€ì¹­)ì˜ createMember()ì—ì„œë„ memberIdë¥¼ ë¦¬í„´í•´ ì¤„ ìˆ˜ ìˆë„ë¡ memberIdë¥¼ ì¶”ê°€í•¨.
3. **Stubbing** ë©”ì„œë“œ(Mockitoì—ì„œ ì§€ì›)
    1. `given()`ì€ Mock ê°ì²´ê°€ íŠ¹ì • ê°’ì„ ë¦¬í„´í•˜ëŠ” ë™ì‘ì„ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©í•˜ë©°, Mockitoì—ì„œ ì§€ì›í•˜ëŠ” `when()`ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤.
        
        ì—¬ê¸°ì„œëŠ” Mock ê°ì²´ì¸ memberService ê°ì²´ë¡œ createMember() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì •ì˜í•˜ê³  ìˆê³  , íŒŒë¼ë¯¸í„°ì¸ `Mockito.any(Member.class)`ëŠ” Mockitoì—ì„œ ì§€ì›í•˜ëŠ” ë³€ìˆ˜ íƒ€ì… ì¤‘ í•˜ë‚˜ì´ë‹¤. íŒŒë¼ë¯¸í„°ëŠ” ì‹¤ì œ ë©”ì„œë“œì—ì„œ ë“¤ì–´ê°€ëŠ” íŒŒë¼ë¯¸í„°ì˜ íƒ€ì…ì„ ì§€ì •í•´ì£¼ë©´ ë˜ëŠ”ë° Mockito.any( )ì— ê°ì‹¸ì„œ ë„£ì–´ì£¼ë©´ ë¨.
        
        - ê°ì²´ì¼ ê²½ìš°ëŠ” ìƒê¸° ì½”ë“œì²˜ëŸ¼ Mockito.any(ê°ì²´ëª….class)
        - long typeì˜ ê²½ìš° Mockito.*anyLong*()
        - int typeì˜ ê²½ìš° Mockito.anyInt()
        - String typeì˜ ê²½ìš° Mockito.*anyString*()
    2. `.willReturn(member)`
        
        MockMemberService(ê°€ì¹­)ì˜ createMember() ë©”ì„œë“œê°€ ë¦¬í„´í•  Stub ë°ì´í„°ì…ë‹ˆë‹¤.
        

<aside>
ğŸ’— Stubbingì´ë€?
í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œ Mock ê°ì²´ê°€ í•­ìƒ ì¼ì •í•œ ë™ì‘ì„ í•˜ë„ë¡ ì§€ì •í•˜ëŠ” ê²ƒì„ ì˜ë¯¸

</aside>

Debugging í•˜ê³  memberServiceë¥¼ ë³´ë©´ MockitpMockìœ¼ë¡œ ê°€ì§œ ê°ì²´ê°€ ë“¤ì–´ì™€ìˆë‹¤.

<img src = "" width = 500/>

<img src = "" width = 500/>

## ì„œë¹„ìŠ¤ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ì— Mockito ì ìš©

- ì¼ë°˜ì ìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë°ì´í„° ì•¡ì„¸ìŠ¤ ê³„ì¸µê³¼ëŠ” ë¬´ê´€í•˜ê²Œ ì„œë¹„ìŠ¤ ê³„ì¸µì— êµ¬í˜„ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìì²´ë¥¼ Spring Frameworkì˜ ë„ì›€ì„ ë°›ì§€ ì•Šê³ ë„ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤.

```java
package com.springboot.member.service;

import com.springboot.exception.BusinessLogicException;
import com.springboot.member.entity.Member;
import com.springboot.member.repository.MemberRepository;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.junit.jupiter.MockitoExtension;

import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.BDDMockito.given;

// ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ Mockitoë¥¼ ì‚¬ìš©í•  ë•Œ í•„ìš”í•œ ì–´ë…¸í…Œì´ì…˜ 
//MockitoExtension ê¸°ëŠ¥ì„ í™•ì¥í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
@ExtendWith(MockitoExtension.class) 
class MemberServiceMockTest {
    @Mock  // MockBeanê³¼ëŠ” ë‹¤ë¦„. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ë„ì›€ì´ í•„ìš” ì—†ì–´ì„œ ì‚¬ìš©
    private MemberRepository memberRepository;

    @InjectMocks 
    // í…ŒìŠ¤íŠ¸í•´ì•¼ í•  ê°ì²´ì— ì£¼ì…í•´ì•¼ í•œë‹¤. 
    //ê°€ì§œ Repositoryë¥¼ ì˜ì¡´í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒ.
    private MemberService memberService;

    @Test
    public void createMemberTest(){
        // given
        
        // ìƒˆë¡œìš´ Member ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        Member member = new Member("jerry@gmail.com", "ì œë¦¬", "010-4111-1111");

        // when
        
        // memberRepositoryì˜ findByEmail ë©”ì„œë“œê°€ ì–´ë–¤ ë¬¸ìì—´ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ë„, 
        //í•­ìƒ Optional.of(member)ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
        given(memberRepository.findByEmail(Mockito.anyString())).willReturn(Optional.of(member));

        // then
        
        // createMember ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ BusinessLogicException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸
        // ì´ í…ŒìŠ¤íŠ¸ëŠ” ì´ë©”ì¼ì´ ì¤‘ë³µë˜ëŠ” ê²½ìš° ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸
        assertThrows(BusinessLogicException.class, () -> memberService.createMember(member));
    }
}

```

- memberRepository Mock ê°ì²´ë¡œ Stubbingì„ í•˜ê³  ìˆìŒ.
    
    `memberRepository.findByEmail(Mockito.anyString())`ì˜ ë¦¬í„´ ê°’ìœ¼ë¡œ `Optional.of(member)`ë¥¼ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ëŠ” â€œ`passed`â€ì´ë‹¤.
    
- Optional.of(member)ì˜ member ê°ì²´ì— í¬í•¨ëœ ì´ë©”ì¼ ì£¼ì†Œê°€ memberService.createMember(member)ì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•œ member ê°ì²´ì— í¬í•¨ëœ ì´ë©”ì¼ ì£¼ì†Œì™€ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— ê²€ì¦ ê²°ê³¼ê°€ â€œpassedâ€