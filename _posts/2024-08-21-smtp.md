---
layout : single
title : "[Project] gmail SMTP ë¡œ ì´ë©”ì¼ ì „ì†¡ê¸°ëŠ¥ êµ¬í˜„ ë° 5.7.8 ì—ëŸ¬"
categories: Project
tag : [project1, practice]
author_profile: true
---

ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}

---


## Gmail ì„¤ì •

1. ë³´ì•ˆ â†’ 2ë‹¨ê³„ ì¸ì¦ ì„¤ì •í•˜ê¸°
2. ì•± ë¹„ë°€ë²ˆí˜¸ ì„¤ì • 
3. Gmail ì„¤ì • > ì „ë‹¬ ë° POP/IMAP > ë³€ê²½ì‚¬í•­ ì €ì¥
    - POP ë‹¤ìš´ë¡œë“œ
    - IMAP ì—‘ì„¸ìŠ¤ ì‚¬ìš©

## ì˜ì¡´ì„± ë° yml íŒŒì¼ ì„¤ì •

### build.gradle

```java
implementation 'org.springframework.boot:spring-boot-starter-mail
```

### application.yml

<img src = "https://github.com/user-attachments/assets/9996dda7-58f0-4b23-9e54-1c1253718631" width=500/>

1. host : SMTP ì„œë²„ í˜¸ìŠ¤íŠ¸
2. port : SMTP ì„œë²„ í¬íŠ¸
3. username : gmail ì£¼ì†Œ (e.g : abc@gmail.com)
4. password : ìœ„ì—ì„œ ì„¤ì •í•œ ì•± ë¹„ë°€ë²ˆí˜¸ 16ìë¦¬
5. auth : ì‚¬ìš©ì ì¸ì¦ ì‹œë„ ì—¬ë¶€, ê¸° ë³¸ ê°’ì€ false ì´ë‹¤.
6. Socket Read Timeout ì‹œê°„(ms) : (ê¸°ë³¸ê°’ : ë¬´í•œëŒ€)
7. StartTLS í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’ : false)

## mail package

email ê´€ë ¨ íŒ¨í‚¤ì§€ ìƒì„±

### **EmailMessage.java**

- ì´ë©”ì¼ ì „ì†¡ì„ ìœ„í•œ ë©”ì‹œì§€ ì •ë³´ë¥¼ ìº¡ìŠí™”í•˜ëŠ” ê°„ë‹¨í•œ ë°ì´í„° ëª¨ë¸
- ì´ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ EmailMessage í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ì˜ ìˆ˜ì‹ ì, ì œëª©, ë‚´ìš© ë“±ì„ ì‰½ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

```java
@Data
@Builder
public class EmailMessage {
    private String to;
    private String subject;
    private String message;
}

```

ìˆ˜ì‹ ìì™€ ì œëª©, ë©”ì„¸ì§€ë¥¼ ì§€ì •í•œë‹¤.

### EmailPostDto

```java
@Getter
public class EmailPostDto {
    private String email;
}
```

### **EmailService.java**

```java
@Slf4j
@Service
public class EmailService {
    private final JavaMailSender javaMailSender;
    private final SpringTemplateEngine templateEngine;

    public EmailService(JavaMailSender javaMailSender, SpringTemplateEngine templateEngine) {
        this.javaMailSender = javaMailSender;
        this.templateEngine = templateEngine;

    }

    public String sendMail(EmailMessage emailMessage, String type) {
        String authNumber = createCode();
        MimeMessage mimeMessage = javaMailSender.createMimeMessage();
        //MimeMessage ìƒì„±

        try {
            MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMessage,false,"UTF-8");
            mimeMessageHelper.setTo(emailMessage.getTo());
            mimeMessageHelper.setSubject(emailMessage.getSubject());
            mimeMessageHelper.setText(setContext(authNumber,type), true);
            javaMailSender.send(mimeMessage);
            //ì´ë©”ì¼ ì „ì†¡
            
            log.info("Success");

            return authNumber;

        } catch (MessagingException e) {
            log.info("fail");
            throw new RuntimeException(e);
        }
    }

    // ì´ë©”ì¼ ì¸ì¦ì½”ë“œ ìƒì„±
    public String createCode() {
        Random random = new Random();
        StringBuffer key = new StringBuffer();
        for (int i = 0; i < 8; i++) {
            int index = random.nextInt(3);

            switch (index) {
                case 0:
                    key.append((char) (random.nextInt(26) + 'a'));
                    break;
                case 1:
                    key.append((char) (random.nextInt(26) + 'A'));
                    break;
                case 2:
                    key.append(random.nextInt(10)); // 0ë¶€í„° 9ê¹Œì§€
                    break;
            }
        }
        return key.toString();
    }

    public String setContext(String code, String type) {
        Context context = new Context();
        context.setVariable("code", code);
        return templateEngine.process(type, context);
    }
}

```

1. ìƒì„±ì ì£¼ì… 
    - JavaMailSender : ì´ë©”ì¼ ì „ì†¡ì„ ìœ„í•œ Springì˜ JavaMailSender ê°ì²´
    - SpringTemplateEngine : : ì´ë©”ì¼ ë³¸ë¬¸ì„ ìƒì„±í•˜ê¸° ìœ„í•´ Thymeleaf í…œí”Œë¦¿ ì—”ì§„ ì‚¬ìš©
2. sendMail ë©”ì„œë“œ
    - EmailMessage : ìœ„ì—ì„œ ë§Œë“  ë°ì´í„° ê°ì²´
    - MimeMessage ìƒì„±: `MimeMessageHelper`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ìˆ˜ì‹ ì, ì œëª©, ê·¸ë¦¬ê³  ë³¸ë¬¸ ë‚´ìš©ì„ ì„¤ì •
    - `javaMailSender.send(mimeMessage)`ë¡œ ì´ë©”ì¼ì„ ì „ì†¡
    - ì˜ˆì™¸ ì²˜ë¦¬ :  ì´ë©”ì¼ ì „ì†¡ì´ ì‹¤íŒ¨í•  ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ê³ , ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤.
3. createCode ë©”ì„œë“œ
    - ì†Œë¬¸ì, ìˆ«ì, ëŒ€ë¬¸ìë¥¼ í¬í•¨í•œ 8ìë¦¬ì˜ ëœë¤ ì½”ë“œ ìƒì„±
4. setContext ë©”ì„œë“œ
    - `Context` ê°ì²´ì— ì¸ì¦ ì½”ë“œë¥¼ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Thymeleaf í…œí”Œë¦¿ì„ ì²˜ë¦¬í•˜ì—¬ ì´ë©”ì¼ ë³¸ë¬¸ì„ ìƒì„±
    - `type` ì¸ìëŠ” ì‚¬ìš©ë  í…œí”Œë¦¿ íŒŒì¼ì„ ì§€ì •

<br>

### EmailController.java

```java
package com.springboot.helper.email;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RequestMapping("/send-mail")
@RestController
public class EmailController {
    private final EmailService emailService;

    public EmailController(EmailService emailService) {
        this.emailService = emailService;
    }

    //íšŒì›ê°€ì… ì´ë©”ì¼ ì¸ì¦ì½”ë“œ ë°œì†¡
    @PostMapping("/email")
    public ResponseEntity sendJoinMail(@RequestBody EmailPostDto emailPostDto) {
        EmailMessage emailMessage = EmailMessage.builder()
                .to(emailPostDto.getEmail())
                .subject("[MeetBTI] íšŒì›ê°€ì…ì„ ìœ„í•œ ì¸ì¦ì½”ë“œ ë°œì†¡")
                .build();

        emailService.sendMail(emailMessage,"email");
        String message = "ì¸ì¦ì½”ë“œê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
        return new ResponseEntity<>(message, HttpStatus.OK);
    }
}

```



## 5.7.8 Username and Password not accept ë°œìƒ

ì´ê±° ë‹¤ í–ˆëŠ”ë° ìê¾¸ username ì´ë‘ passwordê°€ ì¼ì¹˜ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì—ëŸ¬ê°€ ìê¾¸ ë°œìƒí–ˆë‹¤.

<img src = "https://github.com/user-attachments/assets/b335dd3a-4bc5-4092-84ba-8c3f17219534" width=500/>

í˜¹ì‹œ ë‚´ê°€ ìƒê°í•œ Useranameì´ë‘ Passwordê°€ ì˜ëª»ë˜ì—ˆë‚˜ ìƒê°í–ˆëŠ”ë°

[https://www.gmass.co/smtp-test](https://www.gmass.co/smtp-test) ì—¬ê¸°ì„œ í…ŒìŠ¤íŠ¸ í•´ ë³¼ ìˆ˜ ìˆë‹¤ê³  í•´ì„œ í•´ë´¤ë”ë‹ˆ ì˜ë§Œ ë„ì°©í•œë‹¤â€¦

1. Email Configuration ìƒì„±
    
    <img src = "https://github.com/user-attachments/assets/4a732044-2a31-4df3-8573-077efcc65885" width = 500/>
    
    ì•„ë¬´ë¦¬ êµ¬ê¸€ë§í•´ë„ ë‚˜ì˜¤ì§€ ì•Šê³  2ë‹¨ê³„ ì¸ì¦ ë˜ëŠ” ì•±ë¹„ë°€ë²ˆí˜¸ë¡œ í•˜ë¼ëŠ” ê¸€ë°–ì— ì—†ì–´ì„œ í•œì°¸ í—¤ë§¤ë‹¤ê°€ Email Configuration í´ë˜ìŠ¤ ë§Œë“¤ì–´ì„œ í•œë²ˆ ë” ëª…ì‹œí•´ì¤¬ë‹¤.
    

1. í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •
    - InteliJì— ì˜¬ë ¸ì—‡ëŠ”ëŠ”ë° ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ì— ìƒˆë¡œ ë§Œë“¤ì–´ì£¼ê³ 
        
        <img src = "https://github.com/user-attachments/assets/4db7e6fb-6199-463c-a0ee-7e5ab4646630" width = 300/>
        
        <img src = "https://github.com/user-attachments/assets/6e60b619-185a-4860-807f-549dd1a898e4" width = 300/>
        
    - ì´ë¦„ë„ @Valueë³€ê²½í•´ì„œ ì˜¬ë ¸ë”ë‹ˆ í•´ê²°ë˜ì—ˆë‹¤.
        
        <img src = "https://github.com/user-attachments/assets/fb27dcc9-e014-4d6a-ae25-aed4fb1fcaca" width = 500/>
        

ì´ë ‡ê²Œ í•œ ë‹¤ìŒ [localhost:8080/send-mail/email](http://localhost:8080/send-mail/email) ì˜ ì£¼ì†Œì™€ Bodyì— emailì£¼ì†Œë¥¼ ë‹´ì•„ Post ìš”ì²­í•˜ë©´ ë©”ì¼ì´ ì˜ ë„ì°©í•œë‹¤.!!!!!
 <img src = "https://github.com/user-attachments/assets/736c3b96-ad15-41e7-afbc-32abf77a83ab" width = 500/>