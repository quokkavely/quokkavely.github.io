---
layout : single
title : "[Security] Security-basic"
categories: Spring
tag : [Spring, ì‹¤ìŠµ, Security]
author_profile: true
---


ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}


## Spring Security ë€?

ì• í”Œë¦¬ì¼€ì´ì…˜ì— Securityë¥¼ ì ìš©í•˜ì§€ ì•Šìœ¼ë©´

1. ë¡œê·¸ì¸ ê¸°ëŠ¥ (ì¸ì¦,Authentication)ì´ ì—†ìŒ.
2. API ì— ëŒ€í•œ ê¶Œí•œ ë¶€ì—¬(ì¸ê°€, Athorization)ê¸°ëŠ¥ì´ ì—†ìŒ.

    ì¸ì¦ê³¼ ì¸ê°€ ì¤‘ì— ë­ê°€ ë¨¼ì € ì§„í–‰? â†’ ì¸ì¦ì´ ë¨¼ì € â¡ï¸ ê·¸ë‹¤ìŒ **ì¸ê°€**ì²˜ë¦¬ë¥¼ í•˜ê³  ë³´ëƒ„

3. ì›¹ ë³´ì•ˆ ì·¨ì•½ì ì— ëŒ€í•œ ëŒ€ë¹„ê°€ ì „í˜€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ìŒ,<br/> ì¦‰, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í˜‘í•˜ëŠ” ì„¸ì…˜ ê³ ì • ê³µê²©, í´ë¦­ì¬í‚¹ ê³µê²©, CSRF ë“±ì˜ ë³´ì•ˆ ì·¨ì•½ì ì— ëŒ€í•œ<br/> ê³ ë ¤ê°€ ì „í˜€ ì´ë£¨ì–´ì§€ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.

### âœï¸ Spring Security

Spring MVC ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¸ì¦(Authentication)ê³¼ ì¸ê°€(Authorization or ê¶Œí•œ ë¶€ì—¬) ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ë¡œì¨,</br>  Spring MVC ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë³´ì•ˆì„ ì ìš©í•˜ê¸° ìœ„í•œ ì‚¬ì‹¤ìƒì˜ í‘œì¤€

Springì—ì„œ ì§€ì›í•˜ëŠ” Interceptorë‚˜ Servlet Filterë¥¼ ì´ìš©í•´ì„œ ë³´ì•ˆ ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•  ìˆ˜ ìˆì§€ë§Œ<br/> ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆì„ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ Spring Securityì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì§€ì›í•˜ê³  ìˆìœ¼ë¯€ë¡œ<br/> êµ¬ì¡°ì ìœ¼ë¡œ ì˜ ë§Œë“¤ì–´ì§„ ê²€ì¦ëœ Spring Securityë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•œ ì„ íƒ

### âœï¸ Interceptorì™€ Filter

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/c19d59ad-f450-46e6-80af-a11fae9e1b0d" width=400/>

- interceptorëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë„˜ì–´ê°€ê¸° ì§ì „ì— ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•˜ê³  ë³´ë‚´ì¤Œ. (ë³´ì™„ê´€ë ¨ ì´ìŠˆì²˜ë¦¬, ì¸ì¦-ì¸ê°€)
- ê·¸ëŸ°ë° interceptor ì‚¬ìš© ì•ˆí•˜ê³  filterë¥¼ ì‚¬ìš©í•  ê²ƒ.<br/>(ì™œëƒë©´ ë³´ì•ˆì€ ì´ˆê¸° ë‹¨ê³„ì—ì„œ ìš”ì²­ë˜ì•¼ í•˜ëŠ”ë° filter ê°€ ë” ì¼ì° ìš”ì²­ì„ ê°€ë¡œì±„ì–´ì„œ ì²˜ë¦¬ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.-ì „ì—­ì—ì„œ ì ìš©ê°€ëŠ¥)
- filterëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë””ìŠ¤íŒ¨ì³ ì„œë¸”ë¦¿ìœ¼ë¡œ ë„˜ì–´ê°€ê¸° ì§ì „ì— ì²˜ë¦¬í•œë‹¤.
- ë³´ì•ˆ ê´€ë ¨ ì‘ì—…ì„ ìœ„í•´ Spring Securityì—ì„œëŠ” ì£¼ë¡œ Filterê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
- Spring Securityì˜ í•„í„°ê°€ ê³¼ê±°ì—ëŠ” DispatcherServlet ì „ì— ë™ì‘í•˜ë©´ì„œ Spring ì»¨í…Œì´ë„ˆì˜ ë¹ˆë“¤ì„ ì§ì ‘ í™œìš©í•˜ê¸° ì–´ë ¤ì› ì§€ë§Œ, í˜„ì¬ëŠ” ì´ëŸ¬í•œ ì œì•½ì´ í•´ê²°ë˜ì–´ í•„í„°ë„ Springì˜ ë¹ˆì„ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
- 6ë²„ì „ ë¶€í„°ëŠ” ëŒë‹¤ì‹ì„ ì‚¬ìš© , ì•„ì§ 6ë²„ì „ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ë§ì§€ ì•Šì•„ì„œ 5.8ë²„ì „ìœ¼ë¡œ ê³µë¶€í•  ì˜ˆì •.

### âœï¸ Spring Securityë¡œ í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ê°•í™” ê¸°ëŠ¥

Spring Securityë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¼ë“¤ì„ í•  ìˆ˜ ìˆë‹¤.

- ë‹¤ì–‘í•œ ìœ í˜•(**í¼ ë¡œê·¸ì¸ ì¸ì¦**, **í† í° ê¸°ë°˜ ì¸ì¦**, **OAuth 2 ê¸°ë°˜ ì¸ì¦**, LDAP ì¸ì¦)ì˜ ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ ì ìš©
- **ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©ìì˜ ì—­í• (Role)ì— ë”°ë¥¸ ê¶Œí•œ ë ˆë²¨ ì ìš©**
- **ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ì œì–´**
- **ë¯¼ê°í•œ ì •ë³´ì— ëŒ€í•œ ë°ì´í„° ì•”í˜¸í™”**
- SSL ì ìš©
- ì¼ë°˜ì ìœ¼ë¡œ ì•Œë ¤ì§„ ì›¹ ë³´ì•ˆ ê³µê²© ì°¨ë‹¨

ì´ ì™¸ì—ë„ SSO, í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œ ê¸°ë°˜ ì¸ì¦, ë©”ì„œë“œ ë³´ì•ˆ, ì ‘ê·¼ ì œì–´ ëª©ë¡(Access Control List) ê°™ì€ ë³´ì•ˆì„ ìœ„í•œ ê¸°ëŠ¥ë“¤ì„ ì§€ì›í•œë‹¤.

### âœï¸ Spring Securityì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ì–´ ì •ë¦¬

- **Principal(ì£¼ì²´) â†’ ëˆ„ê°€(who?)ë¼ê³  ìƒê°í•˜ë©´ ë¨.**
    - Spring Securityì—ì„œ ì‚¬ìš©ë˜ëŠ” `Principal`ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì, ë””ë°”ì´ìŠ¤ ë˜ëŠ” ì‹œìŠ¤í…œ ë“±ì´ ë  ìˆ˜ ìˆìœ¼ë©°, <br/> ì¼ë°˜ì ìœ¼ë¡œ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ëœ ì‚¬ìš©ìì˜ ê³„ì • ì •ë³´ë¥¼ ì˜ë¯¸í•œë‹¤.
    - ì‹ ì› ì¦ëª…ì´ë‘ì€ ë³„ê°œ â‡’ ì´ê±´ credentialì´ë¼ê³  í•¨ .
- **Authentication(ì¸ì¦)**
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ë³¸ì¸ì´ ë§ìŒì„ ì¦ëª…í•˜ëŠ” ì ˆì°¨ë¥¼ ì˜ë¯¸
    - ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ ì •ë³´ê°€ í•„ìš”í•œë° ì´ë¥¼ `Credential`(ì‹ ì› ì¦ëª… ì •ë³´)ì´ë¼ê³  í•œë‹¤.
    - `Credential` ì€ ì¼ìƒì—ì„œ ëŒ€í‘œì ì¸ ì˜ˆë¡œ ì£¼ë¯¼ë“±ë¡ì¦, ê·¸ë¦¬ê³  íŠ¹ì • ì‚¬ì´íŠ¸ì—ì„œ ë¡œê·¸ì¸ì„ ìœ„í•´ ì…ë ¥í•˜ëŠ” **íŒ¨ìŠ¤ì›Œë“œ**ë„ ë¡œê·¸ì¸ ì•„ì´ë””ë¥¼ ì¦ëª…í•˜ê¸°ìœ„í•œ **Credential**ì´ë‹¤.
- **Authorization(ì¸ê°€ ë˜ëŠ” ê¶Œí•œ ë¶€ì—¬)**
    - Authenticationì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœ ì‚¬ìš©ìì—ê²Œ í•˜ë‚˜ ì´ìƒì˜ ê¶Œí•œ(authority)ì„ ë¶€ì—¬í•˜ì—¬<br/> íŠ¹ì • ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í—ˆê°€í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸í•œë‹¤.
    - ë°˜ë“œì‹œ Authentication ê³¼ì • ì´í›„ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ë©° ê¶Œí•œì€ ì¼ë°˜ì ìœ¼ë¡œ ì—­í• (Role) í˜•íƒœë¡œ ë¶€ì—¬ëœë‹¤.
- **Access Control(ì ‘ê·¼ ì œì–´)**
    - ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” í–‰ìœ„ë¥¼ ì œì–´í•˜ëŠ” ê²ƒì„ ì˜ë¯¸


### âœï¸ Spring Securityë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ 

- ê°€ì¥ í° ì´ìœ ëŠ” **ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•œ ì†”ë£¨ì…˜ìœ¼ë¡œ Spring Security ë§Œ í•œ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸** <br/> Spring Securityê°€ ë‘ ì„¸ê°€ì§€ ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ë¥¼ ë¶™ì¸ ê²ƒë³´ë‹¤ ë” ë‚˜ì€ ê²½ìš°ê°€ ëŒ€ë‹¤ìˆ˜.
- Spring SecurityëŠ” íŠ¹ì • ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì„ ë§Œì¡±í•˜ê¸° ìœ„í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ìš©ì´í•˜ê³ , ìœ ì—°í•œ í™•ì¥ì´ ê°€ëŠ¥í•˜ë‹¤. â†’ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ì–´ë ¤ìš´ ê²½ìš°ê°€ ë§ìŒ.

<br/>


# Spring Securityì˜ ì¸ì¦ì²˜ë¦¬ íë¦„

SSRë¡œ êµ¬í˜„, ì„œì„œíˆ ê°œì„ í•´ ë‚˜ê°ˆ ì˜ˆì •

### âœï¸ SSRê³¼ CSR

1. **SSR**(Server Side Rendering) ë°©ì‹ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì„¸ì…˜ ê¸°ë°˜ì˜ í¼ ë¡œê·¸ì¸ ë°©ì‹ì„ ì ìš©í•˜ê¸°ì—<br/> ê°€ì¥ ì í•©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë©°,<br/> ë˜í•œ í¼ ë¡œê·¸ì¸ ë°©ì‹ì€ Spring Securityì— ì²˜ìŒ ì…ë¬¸í•˜ëŠ” ì‚¬ëŒë“¤ì´ ì´í•´í•˜ê¸°ì— ê°€ì¥ ì í•©í•œ ì¸ì¦ ë°©ì‹<Br/>
    â­ CSR(Client Side Rendering) ë°©ì‹ìœ¼ë¡œ ì´ë•Œë™ì•ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬í˜„ í•´ì™”ì§€ë§Œ,<br/> Spring Securityë¥¼ ì…ë¬¸í•˜ê¸° ìœ„í•´ SSR ë°©ì‹ ì‚¬ìš©

### âœï¸ Hello Spring Security ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°

HTML ë·°ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ **íƒ€ì„ë¦¬í”„(Thymeleaf)**ë¼ëŠ” í…œí”Œë¦¿ ì—”ì§„ì„ ì‚¬ìš©

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/b0e575ab-bd3b-4055-a0cc-5a34d2b5cf9c" width=200/>

1. <span style="color:Green">**Header**</span>
    
    ```html
    <html xmlns:th="<http://www.thymeleaf.org>"
          xmlns:sec="<http://www.thymeleaf.org/thymeleaf-extras-springsecurity5>"> <!-- (1) -->
    <body>
    <div align="right" th:fragment="header">
        <a href="/members/register" class="text-decoration-none">íšŒì›ê°€ì…</a> |
        <span sec:authorize="isAuthenticated()"> <!-- (2) ì¸ì¦ì´ ë˜ì—ˆìœ¼ë©´ ë³´ì—¬ì§€ëŠ” ê²ƒë“¤. -->
                    <span sec:authorize="hasRole('USER')">  <!-- (3) -->
                        <a href="/members/my-page" class="text-decoration-none">ë§ˆì´í˜ì´ì§€</a> |
                    </span>
                    <a href="/logout" class="text-decoration-none">ë¡œê·¸ì•„ì›ƒ</a>  <!-- (4) -->
                    <span th:text="${#authentication.name}">í™ê¸¸ë™</span>ë‹˜  <!-- (5) -->
                </span>
    
        <span sec:authorize="!isAuthenticated()"> <!-- (6) ì¸ì¦ì´ ë˜ì§€ ì•Šì•˜ìœ¼ë©´ -->
                    <a href="/auths/login-form" class="text-decoration-none">ë¡œê·¸ì¸</a>
                </span>
    </div>
    </body>
    </html>
    ```
    
2. <span style="color:Green">**íšŒì›ê°€ì… HTML**</span>
    
    ```html
    <!DOCTYPE html>
    <html xmlns:th="<http://www.thymeleaf.org>"
          xmlns:layout="<http://www.ultraq.net.nz/thymeleaf/layout>"
          layout:decorate="layouts/common-layout">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Hello Spring Security Coffee Shop</title>
    </head>
    <body>
        <hr />
        <div class="container" layout:fragment="content">
            <!-- (1) íšŒì› ê°€ì… í¼ -->
            <form action="/members/register" method="post">
                <div class="row">
                    <div class="col-xs-2">
                        <input type="text" name="fullName" class="form-control" placeholder="User Name"/>
                    </div>
                </div>
                <div class="row" style="margin-top: 20px">
                    <div class="col-xs-2">
                        <input type="email" name="email" class="form-control" placeholder="Email"/>
                    </div>
                </div>
                <div class="row" style="margin-top: 20px">
                    <div class="col-xs-2">
                        <input type="password" name="password" class="form-control" placeholder="Password"/>
                    </div>
                </div>
    
                <button class="btn btn-outline-secondary" style="margin-top: 20px">íšŒì› ê°€ì…</button>
            </form>
        </div>
    </body>
    </html>
    
    ```
    
3. <span style="color:Green">**ë¡œê·¸ì¸**</span>
    
   <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/dd878633-e459-42b8-bc9d-03b12e060c3f" width=400/>
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/d9803082-59a6-4e63-9198-c85f29d1517b" width=400/>
    
    ë¡œê·¸ì¸ í™”ë©´ ì—­ì‹œ HTML form íƒœê·¸ë¡œ êµ¬ì„±ì´ ë˜ì–´ ìˆìœ¼ë©°,<br/> HTMLì˜ form ë°©ì‹ìœ¼ë¡œ ë¡œê·¸ì¸ ì¸ì¦ì„ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—<br/> Spring Securityì—ì„œë„ ì´ëŸ¬í•œ ì¸ì¦ ë°©ì‹ì„ **í¼ ë¡œê·¸ì¸ ì¸ì¦**
    
4. <span style="color:Green">**ì„œë¸Œì‚¬ì´ë“œë Œë”ë§ ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤.**</span>
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/ee46f772-0427-4550-8b13-1ef6b63dbe13" width=400/>  
    

### ë¬¸ì œì 

- ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ êµ¬ì²´ì ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŒ. â†’ ì¸ì¦, ì¸ê°€ë¥¼ êµ¬í˜„í•´ì•¼ í•¨,
    
    ```java
    package com.springboot.auth;
    
    import org.springframework.stereotype.Controller;
    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.PostMapping;
    import org.springframework.web.bind.annotation.RequestMapping;
    
    @Controller
    @RequestMapping("/auths")
    public class AuthController {
        @GetMapping("/login-form")
        public String loginForm() {
            return "login";
        }
    
        @GetMapping("/access-denied")
        public String accessDenied() {
            return "access-denied";
        }
    
        // (1)
        @PostMapping("/login")
        public String login() {
            System.out.println("Login successfully!");
            return "home";
        }
    }
    
    ```
    
    ë¡œê·¸ì¸ ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì— **ì»¤í”¼ë¥¼ ì£¼ë¬¸í•˜ëŠ” íšŒì›ì´ë“ , ë§¤ì¥ì—ì„œ ì»¤í”¼ë¥¼ ë§Œë“¤ì–´ì„œ ì œê³µí•˜ëŠ” ì¹´í˜ ê´€ê³„ìì´ë“  ìƒê´€ì—†ì´ ëª¨ë“  í™”ë©´ì— ììœ ë¡­ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.**
    

## ì• í”Œë¦¬ì¼€ì´ì…˜ì— Spring Security ì ìš©

1. gradleì— ì£¼ì„ì²˜ë¦¬ ë˜ì–´ìˆëŠ” ì¸ì¦ì¸ê°€ë¥¼ í•´ì œí•˜ì—¬ ì˜ì¡´ì£¼ì…í•œë‹¤.
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/6a55d53a-2307-4baf-8cc8-b3502772b51e" width=400/>
    

- ì›ë˜ HomeControllerì—ì„œ ê¸°ë³¸ urlë¡œ ì´ë™ì‹œ homeìœ¼ë¡œ ê°€ê²Œ ì„¤ì •ë˜ì–´ìˆëŠ”ë°<br/>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì ìš©í•˜ë©´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥ì€ ì²« í™ˆ í™”ë©´ì´ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë°”ë€ë‹¤.
    
   <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/173dae64-c4a1-41b4-a5a1-443f5c48e00b" width=400/>
    

- ë¡œê·¸ì¸í•  ë•Œ ì•„ì´ë””ëŠ” ê¸°ë³¸ìœ¼ë¡œ userì´ê³  ë¹„ë°€ë²ˆí˜¸ëŠ” í”„ë¡œê·¸ë¨ ì‹¤í–‰ì‹œ ì œê³µëœë‹¤(ë§¤ë²ˆ ë‹¬ë¼ì§)
    
    <img src = "https://github.com/quokkavely/quokkavely.github.io/assets/165968530/81d2a392-13ac-4df1-ab9c-9e36c4d5441e"/>
    

- ë‚´ ë§ˆìŒëŒ€ë¡œ ì•„ì´ë””ì™€ ë¹„ë°€ ë²ˆí˜¸ë¥¼ ì ìœ¼ë©´ ì‹¤íŒ¨ê¹Œì§€ ì•Œë ¤ì¤€ë‹¤.
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/710c20e0-d20f-48d9-a5dd-2614834d58ca" width=300/>
    
- ì‹¤ë¬´ì— ì ìš©í•˜ê¸° í˜ë“¬ â†’ ì ‘ì†í•  ë•Œë§ˆë‹¤ ë¹„ë°€ë²ˆí˜¸ê°€ ë°”ë€Œê²Œ ë˜ê³ , ë¡œê·¸ì¸ í•´ì„œ ë“¤ì–´ê°€ë©´ ë¡œê·¸ì¸ í™”ë©´ì´ ë˜ ìˆë‹¤(ë‚´ê°€ êµ¬í˜„í•œ ê²ƒ)
- ìŠ¤í”„ë§ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” ì²« í™”ë©´ì˜ ë¡œê·¸ì¸í™”ë©´ê³¼ ë‚´ê°€ êµ¬í˜„í•œ ë¡œê·¸ì¸ í™”ë©´ ë‘ ê°œê°€ ì¤‘ë³µí•´ì„œ ìƒê¸°ê²Œ ë¨.

### 1ï¸âƒ£ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ë³€ê²½

 â­ **Spring Security Configuration ì ìš© â†’** í´ë˜ìŠ¤ì—ì„œ Spring Securityì—ì„œ ì§€ì›í•˜ëŠ” ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ ì„¤ì •í•˜ê¸°

- í”„ë¡œê·¸ë¨ ì„¤ì •ì‹œ ìƒì„±ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ë‹Œ
- ë§¤ë²ˆ ë¹„ë°€ë²ˆí˜¸ê°€ ë°”ë€ŒëŠ” ê²ƒì„ ë‹¤ì‹œ ì„¤ì •í•  ì˜ˆì •, dbëŠ” ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©

<span style="color:Green">**SecurityConfiguration**</span> 

```java
package com.springboot.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.provisioning.UserDetailsManager;

@Configuration //Configurationê³¼ ë¹ˆì´ ìˆìœ¼ë©´ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê²Œ ë¨.
public class SecurityConfiguration {
    @Bean //ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ë„ì›€ì„ ë°›ê¸° ìœ„í•¨
    public UserDetailsManager userDetailService(){
        UserDetails userDetails =
                User.withDefaultPasswordEncoder()
                        .username("jerry@gmail.com") //ì¼ë°˜ì ìœ¼ë¡œ í†µìš©ë˜ëŠ” ì•„ì´ë””ì˜ ê°œë….
                        .password("wpfl")
                        .roles("USER") //ì¸ê°€ : ê¶Œí•œì„ ë­˜ ì¤„ ê²ƒì¸ì§€?
                        .build(); // 3ê°€ì§€ë¥¼ ë‹´ê³  ë¹Œë“œí•˜ë©´
        return new InMemoryUserDetailsManager(userDetails);
        //ìœ ì €ê°ì²´ê°€ ë‚˜ì˜¨ë‹¤.
        // ë©”ì„œë“œëª…ì„ ë³´ë©´ UserDetalisë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ë§¤ë‹ˆì €ë¡œ ë°˜í™˜í•´ì•¼ í•˜ëŠ”ë°
        // ì¸ë©”ëª¨ë¦¬ ë§¤ë‹ˆì €ë¡œ ë°˜í™˜í•¨. ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ë˜ì–´ìˆê³  ì¶”ìƒí™” ë˜ì–´ìˆê¸° ë•Œë¬¸
        // ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆê¸° ë•Œë¬¸ì— ì¸ë©”ëª¨ë¦¬DBì˜ êµ¬í˜„ì²´ë¡œ ì‚¬ìš©
        // ë¹ˆì€ userDetailServiceë¼ëŠ” ë©”ì„œë“œ ëª…ìœ¼ë¡œ ë“±ë¡í•˜ê²Œ ëœë‹¤.

    }
}

```

1. **UserDetails** ì¸í„°í˜ì´ìŠ¤ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì˜ í•µì‹¬ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆìœ¼ë©°,<br/> UserDetails êµ¬í˜„ì²´ì¸  User í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ìƒì„±í•œë‹¤.
    - UserDetails
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/41d1c986-ab2f-4986-b399-c7a28c23ce66" width=400/>
        
    - User
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/c965919e-6a7b-4f87-98c4-3f86372550e2" width=500/>
        
        - ì—¬ê¸°ì„œ usernameì€ ì‚¬ëŒì˜ ì´ë¦„ì´ ì•„ë‹Œ ê³ ìœ í•œ ì‚¬ìš©ìë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ì•„ì´ë”” ê°™ì€ ê°’
        <br/>

        - <span style="color:Green">**User classì— ìˆëŠ” static Method â†’ withDefaultPasswordEncorder( )** 
            <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/999ecb6f-6568-46ca-9452-fbec53b18a00" width=400/><br/>
            - **withDefaultPasswordEncorder( ) ë¡œ ì¸í•´ ì•”í˜¸í™” ëœë‹¤.**
            
            API ë¬¸ì„œì—ì„œ í•´ë‹¹ ë©”ì„œë“œì—ëŠ” ë”ì´ìƒ ì‚¬ìš©í•˜ì§€ë§ë¼ëŠ” **@Deprecated** ì´ ë‹¬ë ¤ìˆì§€ë§Œâ†’ ì‹¤ì œ ì„œë¹„ìŠ¤í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ë¼ëŠ” ì˜ë¯¸ë¡œ ì• ë„ˆí…Œì´ì…˜ì´ ë‹¬ë ¤ìˆëŠ” ê²ƒ - ì§€ê¸ˆ ì—°ìŠµë‹¨ê³„ë¼ì„œ ì˜ë¯¸ ë‘˜ í•„ìš” ì—†ê³  í•˜ë‚˜ì”© ê°œì„ ì˜ˆì •
            <br/>
            
2. ë°˜í™˜ì€ UserDetailsManagerë¡œ í•´ì•¼í•˜ëŠ”ë°,  InMemoryUserDetailsManagerë¡œ ë°˜í™˜í•¨. 
    - ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ë˜ì–´ìˆê³  ì¶”ìƒí™” ë˜ì–´ìˆê¸° ë•Œë¬¸
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/6ff70fe4-99a6-47f3-a2bc-7e9b7e104fa6" width=500/>
        

### 2ï¸âƒ£ ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€ ì‚¬ìš©, í¼ë¡œê·¸ì¸ êµ¬í˜„ (HTTP ë³´ì•ˆ êµ¬ì„±)

**SecurityConfiguration**ì— filterChain ë©”ì„œë“œë¥¼ ìƒì„± <br/> â‡’ HttpSecurityë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ê°€ì§€ê³ , SecurityFilterChainì„ ë¦¬í„´í•˜ëŠ” í˜•íƒœì˜ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ë©´ HTTP ë³´ì•ˆ ì„¤ì •ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤

```java
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        //httpsecurity : ì›¹ë³´ì•ˆì„ ìœ„í•´ì„œ ì‚¬ìš©ë˜ëŠ” í´ë˜ìŠ¤
        //ë¡œê·¸ì¸ì´ ë˜ ìˆìœ¼ë‹ˆê¹Œ ë‚´ê°€ êµ¬í˜„í•œ ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•˜ê²Œ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œ ë©”ì„œë“œë§Œë“¬
        //í¼ë¡œê·¸ì¸ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— í¼ë¡œê·¸ì¸ìœ¼ë¡œ ì‚¬ìš©ì˜ˆì •
						
				//(1)		
        //í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ DISABLE ì‚¬ìš© ì²˜ë¦¬, 
        // **CSRF(Cross-Site Request Forgery) ê³µê²©ì— ëŒ€í•œ Spring Securityì— ëŒ€í•œ ì„¤ì •ì„ ë¹„í™œì„±í™”**
        http.csrf().disable() 
                .formLogin() //(2) 
                .loginPage("/auths/login-form") //(3)
                //ë¡œê·¸ì¸í˜ì´ì§€ ì‚¬ìš©í•˜ëŠ” ì„¤ì •
                .loginProcessingUrl("process_login")
                //ë¡œê·¸ì¸ì„ ì‹¤ì œë¡œ ìˆ˜í–‰í•  ì£¼ì†Œ (ì¸ì¦)
                .failureUrl("/atuhs/login-form?error")
                //ì‹¤ì œ ë¡œê·¸ì¸ì´ ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì–´ë–¤ í˜ì´ì§€ë¥¼ ë³´ë‚¼ ê±´ì§€. ì–´ë–»ê²Œ ì²˜ë¦¬í• ê±´ì§€ ì„¤
                .and()
                .authorizeHttpRequests() //í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì ‘ê·¼ ê¶Œí•œì„ í™•ì¸
                .anyRequest()
                .permitAll();
                    //í´ë¼ì´ì–¸íŠ¸ì˜ ê¶Œí•œì„ ë³¼ê±´ë° ì „ì²´ ë‹¤ ê°€ëŠ¥
        return http.build();
    }
```

1. (1) ì—ì„œ  **CSRF(Cross-Site Request Forgery) ê³µê²©ì— ëŒ€í•œ Spring Securityì— ëŒ€í•œ ì„¤ì •ì„ ë¹„í™œì„±í™”**
    - Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë¬´ ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ csrf() ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° CSRF Tokenì„ ìˆ˜ì‹  í›„, ê²€ì¦í•œë‹¤.
    - but ìš°ë¦¬ëŠ” ë¡œì»¬í™˜ê²½ì´ë¼ì„œ ê³µê²©ì— ëŒ€í•œ ì„¤ì •ì´ ë”°ë¡œ í•„ìš”í•˜ì§€ ì•ŠìŒ
2. (2) ì—ì„œ ê¸°ë³¸ì ì¸ ì¸ì¦ ë°©ë²•ì„ í¼ë¡œê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì§€ì •
3. (3)ì˜ .loginPage("/auths/login-form") ì—ì„œ í•´ë‹¹ íŒŒë¼ë¯¸í„°ì˜ URLì€ AuthControllerì˜ loginForm() í•¸ë“¤ëŸ¬ ë©”ì„œë“œì— ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” URLì´ë‹¤.
4. ë§ˆì°¬ê°€ì§€ë¡œ loginProcessingUrl(**"/process_login"**) ë©”ì„œë“œë¥¼ í†µí•´ ë¡œê·¸ì¸ ì¸ì¦ ìš”ì²­ì„ ìˆ˜í–‰í•  ìš”ì²­ URLì„ ì§€ì • <br/> â†’ "**/process_login**"ì€ ìš°ë¦¬ê°€ ë§Œë“¤ì–´ ë‘” login.htmlì—ì„œ form íƒœê·¸ì˜ action ì†ì„±ì— ì§€ì •í•œ URLê³¼ ë™ì¼
    - ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í™”ë©´ì—ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ <br/> formíƒœê·¸ì˜ actionì†ì„±ì— ì§€ì •ëœ /process_login URLë¡œ ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•œ ì •ë³´ë¥¼ ì „ì†¡(ì´ë©”ì¼ê³¼ íŒ¨ìŠ¤ì›Œë“œ)

### 3ï¸âƒ£ ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€(login.html)ì˜ ì¸ì¦ì‹¤íŒ¨ ë©”ì„¸ì§€ ì¶”ê°€

`${param.error}`ì˜ ê°’ì„ í†µí•´ ë¡œê·¸ì¸ ì¸ì¦ ì‹¤íŒ¨ ë©”ì‹œì§€ í‘œì‹œ ì—¬ë¶€ë¥¼ ê²°ì •

`${param.error}`ëŠ”  Spring Security Configurationì—ì„œ <br/>  
<span style="color:Green">failureUrl("/auths/login-form?error")ì˜ ?error</span> ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì˜ë¯¸

```java
<div class="row alert alert-danger center" role="alert" th:if="${param.error != null}">
	<div>ë¡œê·¸ì¸ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>
</div>
```

### 4ï¸âƒ£ ìš”ì²­ URIì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬

<span style="color:Green">**SecurityConfigurationì—ì„œ filterChainë©”ì„œë“œ ìˆ˜ì •**</span>

```java
@Configuration
public class SecurityConfiguration {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .formLogin()
            .loginPage("/auths/login-form")
            .loginProcessingUrl("/process_login")
            .failureUrl("/auths/login-form?error")
            .and()
            .exceptionHandling().accessDeniedPage("/auths/access-denied")
            .and()
            .authorizeHttpRequests(authorize -> authorize             
                    .antMatchers("/orders/**").hasRole("ADMIN") 
                    .antMatchers("/members/my-page").hasRole("USER")
                    .antMatchers("/**").permitAll()
            );
        return http.build();
    }
```

2ï¸âƒ£ì—ì„œ êµ¬í˜„ëœ filterChain()ì—ì„œ .authorizeHttpRequests().anyRequest().permitAll(); ì„¤ì •ì„ í†µí•´ ë¡œê·¸ì¸ ì¸ì¦ì— ì„±ê³µí•  ê²½ìš°,<br/> ëª¨ë“  í™”ë©´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í–ˆë˜ ë¶€ë¶„ì„ **ì‚¬ìš©ìì˜ Role ë³„ë¡œ request URIì— ì ‘ê·¼ ê¶Œí•œì´ ë¶€ì—¬**ë˜ë„ë¡ ìˆ˜ì •

1. **exceptionHandling().accessDeniedPage("/auths/access-denied")**ë¥¼ í†µí•´<br/> ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • request URIì— ì ‘ê·¼í•  ê²½ìš° ë°œìƒí•˜ëŠ” **403(Forbidden)** ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í˜ì´ì§€ë¥¼ ì„¤ì •
    - **exceptionHandling ()** : Exception ì²˜ë¦¬ë¥¼ ìˆ˜í–‰
    - ë¦¬í„´í•˜ëŠ” **ExceptionHandlingConfigure ê°ì²´**ë¥¼ í†µí•´ êµ¬ì²´ì ì¸ Exception ì²˜ë¦¬ê°€ëŠ¥
    - **accessDeniedPage()** ë©”ì„œë“œëŠ” 403 ì—ëŸ¬ ë°œìƒ ì‹œ, íŒŒë¼ë¯¸í„°ë¡œ ì§€ì •í•œ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ë„ë¡ í•´ì¤€ë‹¤.
2. authorizeHttpRequests() ë©”ì„œë“œì—ì„œ ëŒë‹¤ì‹ìœ¼ë¡œ request URIì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬
    - `antMatchers()` ë©”ì„œë“œëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ **ant**ë¼ëŠ” ë¹Œë“œ íˆ´ì—ì„œ ì‚¬ìš©ë˜ëŠ” `Path Pattern`ì„ ì´ìš©í•´ì„œ ë§¤ì¹˜ë˜ëŠ” URLì„ í‘œí˜„
    - `**`ëŠ” /ordersë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  í•˜ìœ„ URLì„ í¬í•¨
    - `orders/*`ë¼ëŠ” URLì„ ì§€ì •í–ˆë‹¤ë©´ `/orders/1`ê³¼ ê°™ì´ /ordersì˜ í•˜ìœ„ URLì˜ depthê°€ 1ì¸ URLë§Œ í¬í•¨
    - `antMatchers("/members/my-page").hasRole("USER")`ì€ `USER` Roleì„ ë¶€ì—¬ë°›ì€ ì‚¬ìš©ìë§Œ<br/> `/members/my-page` URLì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
    - `.antMatchers("/**").permitAll()`ì€ ì•ì—ì„œ ì§€ì •í•œ URL ì´ì™¸ì˜ ë‚˜ë¨¸ì§€ ëª¨ë“  URLì€ Roleì— ìƒê´€ì—†ì´ ì ‘ê·¼ì´ ê°€ëŠ¥í•¨ì„ ì˜ë¯¸
3. **antMatchers()ë¥¼ ì´ìš©í•œ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬ ì‹œ, ì£¼ì˜ ì‚¬í•­**
    - ë§Œì•½ì— authorizeHttpRequests() ë©”ì„œë“œì—ì„œ `.antMatchers("/**").permitAll()` ì´ ì œì¼ ì•ì— ìœ„ì¹˜í•˜ê²Œ ë˜ë©´ <br/> Roleì— ìƒê´€ì—†ì´ ëª¨ë“  requestURLì— ì ‘ê·¼ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒì— ì˜¤ëŠ” ì ‘ê·¼ ê¶Œí•œ ì¡°ê±´ì€ ì œ ê¸°ëŠ¥ì„ í•˜ì§€ ëª»í•˜ê²Œ ëœë‹¤.
    - í•­ìƒ â­ **ë” êµ¬ì²´ì ì¸ URL ê²½ë¡œë¶€í„° ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•œ ë‹¤ìŒ ëœ êµ¬ì²´ì ì¸ URL ê²½ë¡œì— ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ìŠµê´€ ë“¤ì´ê¸°.**
    
    > ì°¸ê³ ë¡œ AntëŠ” Mavenê³¼ Gradleì— ë°€ë ¤ì„œ ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë¹Œë“œ íˆ´,<br/> but, Antì—ì„œ ì‚¬ìš©ë˜ëŠ” Ant Patternì€ URL ê²½ë¡œ ë“±ì„ ì§€ì •í•˜ê¸° ìœ„í•œ Pattern í‘œí˜„ì‹ìœ¼ë¡œ ì—¬ëŸ¬ ì˜¤í”ˆ ì†ŒìŠ¤ì—ì„œ ì‚¬ìš©ë˜ê³  ìˆë‹¤.<br/>Mavenë„ xmlì„ ì‚¬ìš©í•´ì•¼í•´ì„œ gradleë¡œ ë§ì´ ë„˜ì–´ê°€ëŠ” ì¶”ì„¸
    

### 5ï¸âƒ£ ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ì ì¶”ê°€

```java
...
@Configuration
public class SecurityConfiguration {
    ...
    ...
    @Bean
    public InMemoryUserDetailsManager userDetailsService() {
        UserDetails user =
                User.withDefaultPasswordEncoder()
                        .username("kevin@gmail.com")
                        .password("1111")
                        .roles("USER")
                        .build();
                        
        UserDetails admin =
                User.withDefaultPasswordEncoder()
                        .username("admin@gmail.com")
                        .password("2222")
                        .roles("ADMIN")
                        .build();

        return new InMemoryUserDetailsManager(user, admin);
    }
}
```

### 6ï¸âƒ£ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ì ì•„ì´ë”” í‘œì‹œ ë° ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ.

ë¡œê·¸ì¸ í•œ ì‚¬ìš©ì í‘œì‹œ & ë¡œê·¸ì¸ í•œ ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ í•˜ê¸° & ë§ˆì´í˜ì´ì§€ ë§í¬ëŠ” ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìì—ê²Œë§Œ ë³´ì´ê²Œ í•˜ê¸°

1. header.html ìˆ˜ì • â†’ ë¡œê·¸ì•„ì›ƒ ë° ê¶Œí•œ ë³„ ë©”ë‰´í‘œì‹œí•˜ê¸°
    
    ```html
    <html xmlns:th="<http://www.thymeleaf.org>"
          xmlns:sec="<http://www.thymeleaf.org/thymeleaf-extras-springsecurity5>"> 
          <!-- (1) -->
        <body>
            <div align="right" th:fragment="header">
                <a href="/members/register" class="text-decoration-none">íšŒì›ê°€ì…</a> |
                <span sec:authorize="isAuthenticated()"> <!-- (2) -->
                    <span sec:authorize="hasRole('USER')">  <!-- (3) -->
                        <a href="/members/my-page" class="text-decoration-none">ë§ˆì´í˜ì´ì§€</a> |
                    </span>
                    <a href="/logout" class="text-decoration-none">ë¡œê·¸ì•„ì›ƒ</a>  <!-- (4) -->
                    <span th:text="${#authentication.name}">í™ê¸¸ë™</span>ë‹˜  <!-- (5) -->
                </span>
    
                <span sec:authorize="!isAuthenticated()"> <!-- (6) -->
                    <a href="/auths/login-form" class="text-decoration-none">ë¡œê·¸ì¸</a>
                </span>
            </div>
        </body>
    </html>
    
    ```
    
    - íƒ€ì„ë¦¬í”„ ê¸°ë°˜ì˜ HTML í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë‚˜ ê¶Œí•œ ì •ë³´ë¥¼ ì´ìš©í•´ ì–´ë–¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” <br/> ë¨¼ì € **(1)**ê³¼ ê°™ì´ `sec` íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ XML ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§€ì •, ì§€ì •í•˜ì§€ ì•Šì•„ë„ ë™ì‘í•˜ì§€ë§Œ íƒœê·¸ì— ì—ëŸ¬ í‘œì‹œ ë‚¨.
    - **(2) :** <span> íƒœê·¸ ë‚´ë¶€ì—ì„œ `sec:authorize="isAuthenticated()"`ë¥¼ ì§€ì •í•˜ë©´ í˜„ì¬ í˜ì´ì§€ì— ì ‘ê·¼í•œ ì‚¬ìš©ìê°€ ì¸ì¦ì— ì„±ê³µí•œ ì‚¬ìš©ìì¸ì§€ë¥¼ ì²´í¬
        - â‡’ `isAuthenticated()`ì˜ ê°’ì´ `true`ì´ë©´  <span> íƒœê·¸ í•˜ìœ„ì— í¬í•¨ëœ ì½˜í…ì¸ ë¥¼ í™”ë©´ì— í‘œì‹œ
    - **(3)** : ì¸ì¦ì— ì„±ê³µí•œ ì‚¬ìš©ìë¼ë©´ ë§ˆì´í˜ì´ì§€ëŠ” USER Roleì„ ê°€ì§„ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ ë˜ë„ë¡ í•œë‹¤.
    - **(4)** : (2)ì—ì„œ ë¡œê·¸ì¸ì— ì„±ê³µí•œ ì‚¬ìš©ìëŠ” [ë¡œê·¸ì¸] ë©”ë‰´ ëŒ€ì‹  [ë¡œê·¸ì•„ì›ƒ]ì´ í‘œì‹œëœë‹¤.
        - `href="/logout"`ì—ì„œ <span style="color:Green"> â€œ/logoutâ€ URLì€ SecutiryConfiguration í´ë˜ìŠ¤ì—ì„œ ì„¤ì •í•œ ê°’</span>ê³¼ ê°™ì•„ì•¼ í•œë‹¤.
    - **(5) :** `th:text="${#authentication.name}"`ë¥¼ í†µí•´ ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ usernameì„ í‘œì‹œ â†’ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìëŠ” usernameì´ í‘œì‹œë˜ê³ 
    - **(6) :** sec:authorize="!isAuthenticated()"ë¥¼ í†µí•´ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìê°€ ì•„ë‹ˆë¼ë©´ [ë¡œê·¸ì¸] ë²„íŠ¼ì´ í‘œì‹œë˜ë„ë¡ í•œë‹¤.
        - sec íƒœê·¸ ì‚¬ìš©ì‹œ  build.gradleì—ì„œ ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ í•´ì•¼í•¨
        - implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'
    
    <br/>
2. **SecurityConfiguration  í´ë˜ìŠ¤ì— ë¡œê·¸ì•„ì›ƒ ì„¤ì • ì¶”ê°€**
    - ë¡œê·¸ì•„ì›ƒì„ ëˆŒë €ì„ ë•ŒëŠ” ìŠ¤í”„ë§ ì€ ë¡œê·¸ì•„ì›ƒ urlì„ ì„¤ì • ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ê¶Œí•œì´ ì‚¬ë¼ì§€ê²Œ ì„¤ì • ë˜ì–´ ìˆìŒ. â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê²Œ ë˜ì–´ìˆìŒ,
    - ìš°ë¦¬ê°€ ë¡œê·¸ì•„ì›ƒì„ ì„¤ì •í•˜ë©´  ì„±ê³µí–ˆì„ ë•Œ ë£¨íŠ¸ë¡œ ì´ë™í•˜ê²Œ ì½”ë“œ ì¶”ê°€.
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/c8116d74-7be8-4b63-a7af-3f71f57142ae" width=400/>
        
    - logout() ë©”ì„œë“œëŠ” ë¡œê·¸ì•„ì›ƒ ì„¤ì •ì„ ìœ„í•œ `LogoutConfigurer`ë¥¼ ë¦¬í„´
    - logoutUrl("/logout")ì„ í†µí•´ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ request URLì„ ì§€ì • <br/> â‡’ â­ ì—¬ê¸°ì„œ ì„¤ì •í•œ URLì€ header.htmlì˜ ë¡œê·¸ì•„ì›ƒ ë©”ë‰´ì— ì§€ì •í•œ `href="/logout"`ê³¼ ë™ì¼í•´ì•¼ í•œë‹¤.
    - .logoutSuccessUrl("/") : ë¡œê·¸ì•„ì›ƒì„ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰í•œ ì´í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•  URLì„ ì§€ì •, ì—¬ê¸°ì„œëŠ” ë©”ì¸í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ë„ë¡ ì§€ì •.
    - ë¡œê·¸ì•„ì›ƒ í´ë¦­ ì‹œ í—¤ë”ê°€ ë°”ë€Œê²Œ ë¨.
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/a1b0706e-cdfe-44fb-9225-8eb3ac5901b3" width=200/>
        

# íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„

ì—¬ê¸°ê¹Œì§€ Security filterChainìœ¼ë¡œ ì¸ì¦ì¸ê°€ë¥¼ êµ¬í˜„  â†’ ì´ì œ  ì¸ë©”ëª¨ë¦¬DBë¡œ ë³€ê²½

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/b69da58c-af3b-4692-905e-71a5c2344d07" width=500/>

ì´ UserDetailsê°ì²´ê°€ ìƒˆë¡œ ìƒì„±ë˜ì–´ì•¼í•¨ 

ì•„ì§DBëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²ƒì´ê¸° ë•Œë¬¸ì— InMemoryUserDetailsManagerë¡œ ë°˜í™˜í•  ì˜ˆì •

### **[íšŒì› ê°€ì… í¼ì„ í†µí•œ InMemory User ë“±ë¡]**

íšŒì› ê°€ì… í¼ì„ í†µí•´ InMemory Userë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•œ ì‘ì—… ìˆœì„œ

- PasswordEncoder Bean ë“±ë¡
- MemberService Bean ë“±ë¡ì„ ìœ„í•œ JavaConfiguration êµ¬ì„±
- InMemoryMemberService í´ë˜ìŠ¤ êµ¬í˜„

### 1ï¸âƒ£ **PasswordEncoder Bean ë“±ë¡**

PasswordEncoderëŠ” Spring Securityì—ì„œ ì œê³µí•˜ëŠ” íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤.

> PasswordEncoderëŠ” ë‹¤ì–‘í•œ ì•”í˜¸í™” ë°©ì‹ì„ ì œê³µí•˜ë©°,<br/> Spring Securityì—ì„œ ì§€ì›í•˜ëŠ” PasswordEncoderì˜ ë””í´íŠ¸ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì€ bcryptì´ë‹¤.
> 

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/a847658c-f4e0-46ca-bdf5-86a3cf320cab" width=400>

- íšŒì› ê°€ì… í¼ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬ë˜ëŠ” íŒ¨ìŠ¤ì›Œë“œëŠ” ì•”í˜¸í™”ë˜ì§€ ì•Šì€ í”Œë ˆì¸ í…ìŠ¤íŠ¸(Plain Text)<br/> â†’ ì•”í˜¸í™”í•˜ê¸°ìœ„í•´ passwordEncorderì‚¬ìš©
- **íšŒì› ê°€ì… í¼ì—ì„œ ì „ë‹¬ë°›ì€ íŒ¨ìŠ¤ì›Œë“œëŠ” InMemory Userë¡œ ë“±ë¡í•˜ê¸° ì „ì— ì•”í˜¸í™”ë˜ì–´ì•¼ í•œë‹¤.**
<br/>

<span style="color:Blue">**SecurityConfiguration í´ë˜ìŠ¤ì—ì„œ PasswordEncoderë¥¼ Beanìœ¼ë¡œ ë“±ë¡**</span>

```java
@Configuration
public class SecurityConfiguration {
...

@Bean
public PasswordEncoder passwordEncoder(){
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
    }
}
```

`PasswordEncoderFactories.createDelegatingPasswordEncoder();`ë¥¼ í†µí•´ `DelegatingPasswordEncoder`ë¥¼ ë¨¼ì € ìƒì„±í•˜ëŠ”ë°,<br/> ì´ `DelegatingPasswordEncoder`ê°€ ì‹¤ì§ˆì ìœ¼ë¡œ **PasswordEncoder** êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.

> **ì°¸ê³ )** ê°œë°œí™˜ê²½ì—ì„œë§Œ ì¸ë©”ëª¨ë¦¬ DB ì‚¬ìš©í•  ê±°ê³  @configurationìœ¼ë¡œ ë¹ˆê°ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì„. @Configuration+@beanì„ ì‚¬ìš©í•˜ì§€ì•Šê³  @Component ì‚¬ìš© í•´ë„ ë¨.
> 

### 2ï¸âƒ£ MemberService Bean ë“±ë¡ì„ ìœ„í•œ JavaConfiguration êµ¬ì„±

1. MemberSercice
    
    íšŒì› ê°€ì… í¼ì—ì„œ ì „ë‹¬ë°›ì€ ì •ë³´ë¥¼ ì´ìš©í•´ ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥ë§Œ ìˆìœ¼ë©´ ë˜ë¯€ë¡œ `createMember()` í•˜ë‚˜ë§Œ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ì²´ê°€ ìˆìœ¼ë©´ ëœë‹¤.
    
    ```java
    package com.springboot.member;
    
    public interface MemberService {
        Member createMember(Member member);
    }
    
    ```
    
2. **InMemoryMemberService** â†’ MemberService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” êµ¬í˜„ í´ë˜ìŠ¤
    
    ```java
    package com.springboot.member;
    
    public class InMemoryMemberService implements MemberService {
        public Member createMember(Member member) {
    
            return null; // ë’¤ì—ì„œ êµ¬í˜„ í•  ì˜ˆì •ì´ë‹¤.
        }
    }
    
    ```
    
3. **DBMemberService í´ë˜ìŠ¤ â†’ ë°ì´í„°ë² ì´ìŠ¤ì— Userë¥¼ ë“±ë¡**í•˜ê¸° ìœ„í•œ MemberService ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤
    
    ```java
    package com.springboot.member;
    
    import org.springframework.transaction.annotation.Transactional;
    
    @Transactional
    public class DBMemberService implements MemberService {
        public Member createMember(Member member) {
             return null; // InMemory User ë“±ë¡ì´ ëë‚œ ë‹¤ìŒ í•™ìŠµë‚´ìš©,  ì´ì–´ì„œ ë°”ë¡œ êµ¬í˜„
        }
    }
    
    ```
    

1. **JavaConfiguration êµ¬ì„± :**  MemberService Bean ë“±ë¡ì„ ìœ„í•œ JavaConfiguration êµ¬ì„±
    
    ```java
    package com.springboot.config;
    
    import com.springboot.member.InMemoryMemberService;
    import com.springboot.member.MemberService;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.security.crypto.password.PasswordEncoder;
    import org.springframework.security.provisioning.UserDetailsManager;
    
    @Configuration
    public class JavaConfiguration {
        
        @Bean
        public MemberService inMemoryMemberService(UserDetailsManager userDetailsManager,
                                                   PasswordEncoder passwordEncoder) {
            return new InMemoryMemberService(userDetailsManager, passwordEncoder);
        }
    }
    
    ```
    
    - MemberService ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ì¸ InMemoryMemberServiceë¥¼ Spring Beanìœ¼ë¡œ ë“±ë¡
    - **ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ì—†ì´ ë©”ëª¨ë¦¬ì— Spring Securityì˜ Userë¥¼ ë“±ë¡**í•´ì•¼ í•˜ë¯€ë¡œ `UserDetailsManager` ê°ì²´ê°€ í•„ìš”
    - User ë“±ë¡ ì‹œ, **íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•œ í›„ì— ë“±ë¡**í•´ì•¼ í•˜ë¯€ë¡œ Spring Securityì—ì„œ ì œê³µí•˜ëŠ” `PasswordEncoder` ê°ì²´ê°€ í•„ìš”
    - ë‘ ê°ì²´ë¥¼ InMemoryMemberService ê°ì²´ ìƒì„± ì‹œ, DI í•´ ì£¼ì–´ì•¼ í•œë‹¤.
    

### **3ï¸âƒ£ InMemoryMemberService êµ¬í˜„**

```java
package com.springboot.member;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.provisioning.UserDetailsManager;

import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

//(1) @Service ì• ë„ˆí…Œì´ì…˜ì€ ì—¬ê¸°ì— ë‹¬ì§€ ì•ŠëŠ”ë‹¤, ì¤‘ë³µì•ˆë¨. ë°”ë¡œ ìœ„ JavaConfigurationì—ì„œ ë°˜í™˜ë˜ëŠ” 
// InMemoryMemberServiceê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì—ˆê¸° ë•Œë¬¸.
public class InMemoryMemberService implements MemberService {
     //(2)
    private final UserDetailsManager userDetailsManager;
  
    private final PasswordEncoder passwordEncoder;

    public InMemoryMemberService(UserDetailsManager userDetailsManager, PasswordEncoder passwordEncoder) {
        this.userDetailsManager = userDetailsManager;
        this.passwordEncoder = passwordEncoder;
    }

    @Override
    public Member createMember(Member member) {
		  //(3)
        List<GrantedAuthority> authorities = createAuthories(Member.MemberRole.ROLE_USER.name());
        //ì¼ë°˜ì ì¸ íšŒì›ê°€ì…ì€ userë¡œ ê¶Œí•œ ì„¤ì •í•´ì¤Œ
        //íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ì˜¨ memberëŠ” dtoì—ì„œ ë³€í™˜ ëœ ê²ƒ , ë¹„ë°€ë²ˆí˜¸ëŠ” ì•„ì§ í‰ë¬¸ì´ë‹¤. ì•”í˜¸í™”í•´ì•¼ í•¨.
        //ì¸ê°€ëŠ” Listë¡œ ê´€ë¦¬ í•œë‹¤..

        String encryptedPassword = passwordEncoder.encode(member.getPassword());
       
       //(4)
        UserDetails userDetails = new User(member.getEmail(), encryptedPassword, authorities);
                                    //ìš°ë¦¬ê°€ ë§Œë“  ìœ ì € ì•„ë‹˜.

        userDetailsManager.createUser(userDetails); 
		        //UserDetailsManagerì˜ createUser() ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ Userë¥¼ ë“±ë¡
        return member;
    }

		//(5) 
    private List<GrantedAuthority> createAuthories(String ...roles){
        return Arrays.stream(roles)
                .map(role-> new SimpleGrantedAuthority(role))
                .collect(Collectors.toList());

        //ê¶Œí•œì„ ë¦¬ìŠ¤ë¥´í†  ë°›ëŠ” ì´ìœ 
        //í•œ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ê°œì˜ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸
        //ì˜ˆë¥¼ ë“¤ì–´, í•œ ì‚¬ìš©ìê°€ ROLE_USERì™€ ROLE_ADMIN ê¶Œí•œì„ ë™ì‹œì— ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
        // ë”°ë¼ì„œ ê¶Œí•œì„ ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•˜ì—¬ ìœ ì—°í•˜ê²Œ ì—¬ëŸ¬ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

    }
}

```

- (1) ì—ì„œ @Service ì• ë„ˆí…Œì´ì…˜ì€  ë‹¬ì§€ ì•ŠëŠ”ë‹¤ â†’ ë¹ˆì€ ì¤‘ë³µì´ ë˜ë©´ ì•ˆëœë‹¤. <br> ë°”ë¡œ ìœ„ JavaConfigurationì—ì„œ ë°˜í™˜ë˜ëŠ”InMemoryMemberServiceê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì—ˆê¸° ë•Œë¬¸.
- (2)  ì—ì„œ  `UserDetailsManager`ì™€ `PasswordEncoder`ë¥¼ DI ë°›ëŠ”ë‹¤.
    - UserDetailsManagerëŠ” Spring Securityì˜ Userë¥¼ ê´€ë¦¬í•˜ëŠ” ê´€ë¦¬ì ì—­í• ì„ í•œë‹¤..
    - SecurityConfigurationì—ì„œ ë¹ˆ ì„¤ì •ì„ í•œ ì´ìœ ëŠ” ì—¬ê¸°ì„œ ì£¼ì…í•˜ë ¤ê³  <br/> â‡’ PSA (Policy Service Abstraction) ì›ì¹™ì— ë”°ë¼ ì¶”ìƒ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ì„œë“œ ì´ë¦„ì„ ë°”ê¾¸ì§€ ì•Šê³ ë„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì£¼ì… ê°€ëŠ¥
    - UserDetailsManager ì¸í„°í˜ì´ìŠ¤ì˜ í•˜ìœ„ íƒ€ì…ì€`InMemoryUserDetailsManager`ë¼ëŠ” ì‚¬ì‹¤ ê¸°ì–µí•˜ê¸°.
- (3) : Spring Securityì—ì„œ Userë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ Userì˜ ê¶Œí•œ(Authority)ì„ ì§€ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤.
    - `createAuthorities(Member.MemberRole.ROLE_USER.name());`ë¥¼ ì´ìš©í•´ Userì˜ ê¶Œí•œ ëª©ë¡ì„ `List<GrantedAuthority>`ë¡œ ìƒì„±
    - Member í´ë˜ìŠ¤ì—ëŠ” `MemberRole`ì´ë¼ëŠ” enumì´ ì •ì˜ë˜ì–´ìˆë‹¤.
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/88e6da2f-601c-4089-a426-51c44126f7c3" width=400/>
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/137c2a33-e11c-4b8a-9962-6b53cf1f59da" width=400/>

        
    - â­ Spring Securityì—ì„œëŠ” `SimpleGrantedAuthority`ë¥¼ ì‚¬ìš©í•´ Role ë² ì´ìŠ¤ í˜•íƒœì˜ ê¶Œí•œì„ ì§€ì •í•  ë•Œ <br/> `â€˜ROLE_â€™ + ê¶Œí•œ ëª…` í˜•íƒœë¡œ ì§€ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì ì ˆí•œ ê¶Œí•œ ë§¤í•‘ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ ê¸°ì–µí•˜ê¸°
- (4)ì—ì„œëŠ” Spring Security Userë¡œ ë“±ë¡í•˜ê¸° ìœ„í•´ `UserDetails`ë¥¼ ìƒì„±í•œë‹¤.
    
    â­ Spring Securityì—ì„œëŠ” Spring Securityì—ì„œ ê´€ë¦¬í•˜ëŠ” User ì •ë³´ë¥¼ `UserDetails`ë¡œ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒ ê¼­ ê¸°ì–µí•˜ê¸°
    
- (5) ì˜ createAuthories ë©”ì„œë“œ : Stream APIë¥¼ ì´ìš©í•´ ìƒì„±ì íŒŒë¼ë¯¸í„°ë¡œ í•´ë‹¹ Userì˜ Roleì„ ì „ë‹¬í•˜ë©´ì„œ `SimpleGrantedAuthority` ê°ì²´ë¥¼ ìƒì„±í•œ í›„, `List<SimpleGrantedAuthority>` í˜•íƒœë¡œ ë¦¬í„´

## ë°ì´í„° ë² ì´ìŠ¤ ì—°ë™ì„ í†µí•œ ë¡œê·¸ì¸ ì¸ì¦

í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ë¯€ë¡œ DBë„ ì¸ë©”ëª¨ë¦¬ë¡œ ì‚¬ìš©í•  ì˜ˆì • 

### Custom UserDetailsServiceë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

Spring Securityì—ì„œëŠ” Userì˜ ì¸ì¦ ì •ë³´ë¥¼ í…Œì´ë¸”ì— ì €ì¥í•˜ê³ , í…Œì´ë¸”ì— ì €ì¥ëœ ì¸ì¦ ì •ë³´ë¥¼ ì´ìš©í•´ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë°©ë²•ì´ ìˆê³  ê·¸ ì¤‘ í•˜ë‚˜ê°€ Custom UserDetailsServiceë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ.

### 1ï¸âƒ£ **SecurityConfigurationì˜ ì„¤ì • ë³€ê²½ ë° ì¶”ê°€**

1. H2ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†ì„ í•˜ê¸° ìœ„í•´ ë·°ë‹¨ì—ì„œ SameOriginì„¤ì • í•´ì•¼ ë³¼ ìˆ˜ ìˆìŒ.
    
    ```java
    @Configuration
    public class SecurityConfiguration {
     @Bean
     public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    
            http. headers().frameOptions().sameOrigin()
                    //ê°™ì€ í˜ì´ì§€ì¼ ê²½ìš° í˜ì´ì§€ë Œë”ë§ì„ í—ˆìš©í•˜ê² ë‹¤ 
                    // ì‹¤ë¬´ì—ì„œë„ ì•„ë§ˆ ì•ˆì“¸ í™•ë¥ ì´ ë†’ìŒ.
                .and()
                .csrf().disable()
                .formLogin()
                ...
                ...
                return http.build();
                
    ```
    

1.  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì–´ ìˆëŠ” ì¸ì¦ ì •ë³´ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë¼ì„œ InMemory Userë¥¼ ìœ„í•œ ì„¤ì •ë“¤ì€ ë” ì´ìƒ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì œê±°,<br/> ì•„ë˜ ì½”ë“œëŠ” ë‹¤ ì œê±°í•˜ë©´ ëœë‹¤.
    
    ```java
        @Bean //ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ë„ì›€ì„ ë°›ê¸° ìœ„í•¨ => ì‚¬ì‹¤ì€ javaconfigurationì—ì„œ ì£¼ì…í•˜ê¸° ìœ„í•¨
        public UserDetailsManager userDetailService(){
    //        UserDetails user =
    //                User.withDefaultPasswordEncoder()
    //                        .username("jerry@gmail.com") 
    //                        .password("wpfl")
    //                        .roles("USER") 
    //                        .build(); 
            UserDetails admin =
                    User.withDefaultPasswordEncoder()
                            .username("admin@gmail.com") //ì¼ë°˜ì ìœ¼ë¡œ í†µìš©ë˜ëŠ” ì•„ì´ë””ì˜ ê°œë….
                            .password("ehowl")
                            .roles("ADMIN") //ì¸ê°€ : ê¶Œí•œì„ ë­˜ ì¤„ ê²ƒì¸ì§€?
                            .build();
            return new InMemoryUserDetailsManager(admin);
       
    
        }
    ```
    



### **2ï¸âƒ£ JavaConfigurationì˜ Bean ë“±ë¡ ë³€ê²½**

 ë°ì´í„°ë² ì´ìŠ¤ì— Userì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ MemberService ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ inMemoryMemberServiceì—ì„œ DBMemberServiceë¡œ ë³€ê²½

```java
...
@Configuration
public class JavaConfiguration {
    @Bean
    public MemberService inMemoryMemberService(UserDetailsManager userDetailsManager,
                                               PasswordEncoder passwordEncoder) {
        return new InMemoryMemberService(userDetailsManager, passwordEncoder);
    }
}

```

â¬‡ï¸â¬‡ï¸     â¬‡ï¸â¬‡ï¸

```java
@Configuration
public class JavaConfiguration {
    // (1)
    @Bean
    public MemberService dbMemberService(MemberRepository memberRepository,
                                         PasswordEncoder passwordEncoder) {
        return new DBMemberService(memberRepository, passwordEncoder); (1-1)
    }
}
```

DBMemberServiceëŠ” ë‚´ë¶€ì—ì„œ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³ , <br/> íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•´ì•¼ í•˜ë¯€ë¡œ  `MemberRepository`ì™€ `PasswordEncoder` ê°ì²´ë¥¼ DI í•´ì¤€ë‹¤.

### 3ï¸âƒ£ **DBMemberService êµ¬í˜„**

```java
@Transactional
public class DBMemberService implements MemberService {
    private final MemberRepository memberRepository;
    private final PasswordEncoder passwordEncoder;

    public DBMemberService(MemberRepository memberRepository,
                             PasswordEncoder passwordEncoder) {
        this.memberRepository = memberRepository;
        this.passwordEncoder = passwordEncoder;
    }

    public Member createMember(Member member) {
        verifyExistsEmail(member.getEmail());
        String encryptedPassword = passwordEncoder.encode(member.getPassword());  // (1)
        member.setPassword(encryptedPassword);    // (2)

        Member savedMember = memberRepository.save(member);

        System.out.println("# Create Member in DB");
        return savedMember;
    }

    ...
    ...
}

```

- (1)ì—ì„œ PasswordEncoderë¥¼ ì´ìš©í•´ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•œë‹¤.
- (2)ì—ì„œ ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œë¥¼ password í•„ë“œì— ë‹¤ì‹œ í• ë‹¹í•œë‹¤.

### **4ï¸âƒ£ Custom UserDetailsService êµ¬í˜„  - V1**

**ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ Userì˜ ì¸ì¦ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì„ ì²˜ë¦¬**

> **â­ UserDetailsService**
> 
> 
> Spring Securityì—ì„œ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ ì¤‘ í•˜ë‚˜ì¸ `UserDetailsService`ëŠ” User ì •ë³´ë¥¼ ë¡œë“œ(load)í•˜ëŠ” í•µì‹¬ ì¸í„°í˜ì´ìŠ¤
> 
> ì—¬ê¸°ì„œ ë¡œë“œ(load)ì˜ ì˜ë¯¸ëŠ” **ì¸ì¦ì— í•„ìš”í•œ User ì •ë³´ë¥¼ ì–´ë”˜ê°€ì—ì„œ ê°€ì§€ê³  ì˜¨ë‹¤**ëŠ” ì˜ë¯¸ì´ë©°, ì—¬ê¸°ì„œ ë§í•˜ëŠ” â€˜**`ì–´ë”˜ê°€`**â€™ëŠ” ë©”ëª¨ë¦¬ê°€ ë  ìˆ˜ë„ ìˆê³ , DB ë“±ì˜ ì˜êµ¬ ì €ì¥ì†Œê°€ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
> 
> ìš°ë¦¬ê°€ InMemory Userë¥¼ ë“±ë¡í•˜ëŠ” ë° ì‚¬ìš©í–ˆë˜ InMemoryUserDetailsManagerëŠ” UserDetailsManager ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì´ê³ , UserDetailsManagerëŠ” UserDetailsServiceë¥¼ ìƒì†í•˜ëŠ” í™•ì¥ ì¸í„°í˜ì´ìŠ¤


1. **HelloUserDetailsService**

    ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¸ì¦ ì •ë³´ë¡œ ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” Custom UserDetailsService
    
    ```java
    @Component
    public class HelloUserDetailsServiceV1 implements UserDetailsService {   // (1)
        private final MemberRepository memberRepository;
        private final HelloAuthorityUtils authorityUtils;
    
        // (2)
        public HelloUserDetailsServiceV1(MemberRepository memberRepository, HelloAuthorityUtils authorityUtils) {
            this.memberRepository = memberRepository;
            this.authorityUtils = authorityUtils;
        }
    
        // (3)
        @Override
        public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
            Optional<Member> optionalMember = memberRepository.findByEmail(username);
            Member findMember = optionalMember.orElseThrow(() -> new BusinessLogicException(ExceptionCode.MEMBER_NOT_FOUND));
    
            // (4)
            Collection<? extends GrantedAuthority> authorities = authorityUtils.createAuthorities(findMember.getEmail());
    
            // (5) ê°œì„ í•˜ë©´ ì¢‹ì€ í¬ì¸íŠ¸
            return new User(findMember.getEmail(), findMember.getPassword(), authorities);
        }
    }
    ```
    
    - **(1)** :  `UserDetailsService` **ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤.**
    - **(2)** : ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ Userë¥¼ ì¡°íšŒí•˜ê³ , ì¡°íšŒí•œ Userì˜ ê¶Œí•œ(Role) ì •ë³´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ 
            `MemberRepository`ì™€ `HelloAuthorityUtils` í´ë˜ìŠ¤ë¥¼ DI ë°›ëŠ”ë‹¤.
    - `UserDetailsService` ì¸í„°í˜ì´ìŠ¤ë¥¼ implements í•˜ëŠ” êµ¬í˜„ í´ë˜ìŠ¤ëŠ” 
        **(3)**ê³¼ ê°™ì´ `loadUserByUsername(String username)`ì´ë¼ëŠ” ì¶”ìƒ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
    - `HelloAuthorityUtils`ë¥¼ ì´ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ íšŒì›ì˜ ì´ë©”ì¼ ì •ë³´ë¥¼ ì´ìš©í•´ Role ê¸°ë°˜ì˜ ê¶Œí•œ ì •ë³´(`GrantedAuthority`) ì»¬ë ‰ì…˜ì„ ìƒì„±í•œë‹¤.
    - **(4)** ì—ì„œ ìƒì„±í•œ ê¶Œí•œ ì •ë³´ë¥¼ Spring Securityì—ì„œëŠ” ì•„ì§ ì•Œì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— Spring Securityì— ì´ ì •ë³´ë“¤ì„ ì œê³µí•´ ì£¼ì–´ì•¼ í•˜ë©°, **(5)** ì—ì„œëŠ” `UserDetails` ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì¸ `User` í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ í†µí•´ ì œê³µ
    - (5)ì™€ ê°™ì´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ User í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ë¦¬í„´í•˜ë©´ Spring Securityê°€ ì´ ì •ë³´ë¥¼ ì´ìš©í•´ ì¸ì¦ ì ˆì°¨ë¥¼ ìˆ˜í–‰í•œë‹¤.
    
    â­ **ì¦‰, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ Userì˜ ì¸ì¦ ì •ë³´ë§Œ Spring Securityì— ë„˜ê²¨ì£¼ê³ , ì¸ì¦ ì²˜ë¦¬ëŠ” Spring Securityê°€ ëŒ€ì‹ í•´ ì¤€ë‹¤**
    
    > â­ UserDetails
    > 
    > 
    > `UserDetails`ëŠ” UserDetailsServiceì— ì˜í•´ ë¡œë“œ(load)ë˜ì–´ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í•µì‹¬ User ì •ë³´ë¥¼ í‘œí˜„í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
    > 
    > `UserDetails` ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ëŠ” Spring Securityì—ì„œ ë³´ì•ˆ ì •ë³´ ì œê³µì„ ëª©ì ìœ¼ë¡œ ì§ì ‘ ì‚¬ìš©ë˜ì§€ëŠ” ì•Šê³ , `Authentication` **ê°ì²´ë¡œ ìº¡ìŠí™”ë˜ì–´ ì œê³µëœë‹¤.**
    > 
    <br/>

1.  **HelloAuthorityUtils**
    
    ```java
    package com.springboot.auth.utils;
    
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.security.core.GrantedAuthority;
    import org.springframework.security.core.authority.AuthorityUtils;
    import org.springframework.stereotype.Component;
    import java.util.List;
    
    @Component
    public class HelloAuthorityUtils {
        // (1)
        @Value("${mail.address.admin}")
        private String adminMailAddress;
    
        // (2)
        private final List<GrantedAuthority> ADMIN_ROLES = AuthorityUtils.createAuthorityList("ROLE_ADMIN", "ROLE_USER");
    
        // (3)
        private final List<GrantedAuthority> USER_ROLES = AuthorityUtils.createAuthorityList("ROLE_USER");
    
        public List<GrantedAuthority> createAuthorities(String email) {
            // (4)
            if (email.equals(adminMailAddress)) {
                return ADMIN_ROLES;
            }
            return USER_ROLES;
        }
    }
    
    ```
    
    - (1)ì€ application.ymlì— ì¶”ê°€í•œ í”„ë¡œí¼í‹°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í‘œí˜„ì‹
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/365b61ce-a957-4dba-96dd-77d7a59598ca" width=300/>
        
        - ì´ê±¸ ë„£ëŠ”ë‹¤ê³  ìë™ìœ¼ë¡œ ê´€ë¦¬ìê¶Œí•œì˜ ë©”ì¼ì´ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤
        - ì´ê±¸ ì„¤ì •í•˜ë©´ (4)ì—ì„œ ê°€ì…í•œ ì‚¬ëŒì˜ ì´ë©”ì¼ì„ ê²€ì¦í•œë‹¤. <br/>â‡’  adminìœ¼ë¡œ ë„£ì–´ë‘” ì´ë©”ì¼ê³¼ ë™ì¼í•œì§€, ë§Œì•½ ë™ì¼í•˜ë‹¤ë©´ ADMIN_ROLESë¥¼ ë¶€ì—¬ ,<br/> ì•„ë‹ˆë¼ë©´ USER_ROLES â†’ ì¸ê°€ëŠ” ë¡œê·¸ì¸ í•˜ê³  ë‚˜ì„œ ì¸ê°€ê°€ ì´ë£¨ì–´ì§.
        <br/>
            
        > â­ ì‹¤ë¬´ì—ì„œëŠ” ë‹¹ì—°íˆ íšŒì› ê°€ì… ì‹œ, ì•„ë¬´ëŸ° ì¸ì¦ ì¥ì¹˜ë„ ì—†ì´ ì´ë©”ì¼ ì£¼ì†Œë§Œ ì…ë ¥í•´ì„œ ê´€ë¦¬ì ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.
        > 
        > 
        > ê´€ë¦¬ì ê¶Œí•œì€ ì•„ë¬´ë¦¬ ê°•ì¡°í•´ë„ ì§€ë‚˜ì¹˜ì§€ ì•Šì„ ì •ë„ë¡œ ì¤‘ìš”!
        > 
        > **ê´€ë¦¬ìë¡œì„œ ë“±ë¡í•˜ê¸° ìœ„í•œ ì¶”ê°€ì ì¸ ì¸ì¦ ì ˆì°¨**ê°€ ìˆì„ ê²ƒ
        >
        <br/> 
    - (4)ì—ì„œ `List<GrantedAuthority>` ë¥¼ ë¦¬í„´í•˜ë©´ íšŒì›ì—ê²Œ ì¸ê°€ê°€ ë¶€ì—¬ ë¨.
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/3fa8e4b6-2803-4019-b8b1-02744653e190" width=400/>
        

1. **H2 ì›¹ ì½˜ì†”ì—ì„œ ë“±ë¡í•œ íšŒì› ì •ë³´ í™•ì¸ ë° ë¡œê·¸ì¸ ì¸ì¦ í…ŒìŠ¤íŠ¸**
    - íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ ì˜ ë¨.
        
        <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/4f617f2b-c01c-4da9-88c7-3268cd195660"/>
        
    - h2 console í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ë³´ ë“¤ì–´ì˜´
        
       <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/ca07bbcd-43a0-46a7-92a8-d8a80bc563d4"/>
        
        PASSWORD ì—´ì„ ë³´ë©´ íšŒì› ê°€ì… ë©”ë‰´ì—ì„œ ì…ë ¥í–ˆë˜ **íŒ¨ìŠ¤ì›Œë“œ ì •ë³´ê°€ ì•”í˜¸í™” ë˜ì–´ìˆë‹¤**
        

### 5ï¸âƒ£ `HelloUserDetailsServiceV2`ìƒì„± 

V1ì— ìˆë˜ @Component ëŠ” ì‚­ì œí•´ì•¼ í•¨. í•˜ë‚˜ë§Œ ìˆì–´ì•¼ í•œë‹¤.

 UserDetailsì˜ êµ¬í˜„ í´ë˜ìŠ¤ì¸ Userì˜ ê°ì²´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ìƒì„±í•´ì„œ ë¦¬í„´í•˜ëŠ” ë¶€ë¶„ì„ ê°œì„ í•  ê²ƒ.

```java
package com.springboot.auth;

import com.springboot.exception.BusinessLogicException;
import com.springboot.exception.ExceptionCode;
import com.springboot.member.Member;
import com.springboot.member.MemberRepository;
import com.springboot.utils.HelloAuthorityUtils;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Component;

import java.util.Collection;
import java.util.List;
import java.util.Optional;

@Component
public class HelloUserDetailsServiceV2 implements UserDetailsService {
    private final MemberRepository memberRepository;
    private final HelloAuthorityUtils helloAuthorityUtils;

    public HelloUserDetailsServiceV2(MemberRepository memberRepository, HelloAuthorityUtils helloAuthorityUtils) {
        this.memberRepository = memberRepository;
        this.helloAuthorityUtils = helloAuthorityUtils;
    }

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //UserDetailsServiceë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„ìˆ˜ë¡œ ìˆì–´ì•¼ í•˜ëŠ” ë©”ì„œë“œ
        Optional<Member> optionalMember = memberRepository.findByEmail(username);
        Member findMember = optionalMember.orElseThrow(()-> new BusinessLogicException(ExceptionCode.MEMBER_NOT_FOUND));

        //List<GrantedAuthority> authorities=helloAuthorityUtils.createAuthorities(findMember.getEmail());
        //return new User(findMember.getEmail(), findMember.getPassword(), authorities);
				return new HelloUserDetails(findMember);
    }
    
    
    //------------------------ì¶”ê°€í•œ ì½”ë“œ --------------------------------------

    //ì´ë„ˆ í´ë˜ìŠ¤ ìƒì„± , ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„í•˜ë©´ì„œ ì—”í‹°í‹°ë¥¼ ìƒì†. ìƒì†ì´ ë¨¼ì €ì™€ì•¼ í•œë‹¤.
    private final class HelloUserDetails  extends Member implements UserDetails{

        //ì•„ë˜ í´ë˜ìŠ¤ëŠ” ë©¤ë²„ë¥¼ ìƒì†í•˜ê¸° ë•Œë¬¸ì— í•„ë“œì— ì—†ì–´ë„ ë‹¤ ê°€ì§€ê³  ìˆë‹¤ (Member ê°€ superí´ë˜ìŠ¤ì— í•´ë‹¹)
        // (privateë¡œ ì„ ì–¸ëœ ê²ƒì„ ì œì™¸í•˜ê³ , getter setterëŠ” ë‹¤ public ì´ê¸° ë•Œë¬¸ì— ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ê°€ëŠ¥)
        HelloUserDetails(Member member){
            setMemberId(member.getMemberId());
            setEmail(member.getEmail());
            setFullName(member.getFullName());
            setPassword(member.getPassword());
        }

        @Override
        public Collection<? extends GrantedAuthority> getAuthorities() { //ì¸ê°€ì •ë³´ë¥¼ ë§Œë“¤ì–´ ì£¼ì–´ì•¼ í•¨.
            return helloAuthorityUtils.createAuthorities(this.getEmail());//HelloUserDetailsì˜ ì´ë©”ì¼ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒ-> this
        }

        @Override
        public String getUsername() {
            return this.getEmail();
        }

//í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šì•„ì„œ ëª¨ë‘ trueë¡œ ë³€ê²½
        @Override
        public boolean isAccountNonExpired() {
            return true;
        }

        @Override
        public boolean isAccountNonLocked() {
            return true;
        }

        @Override
        public boolean isCredentialsNonExpired() {
            return true;
        }

        @Override
        public boolean isEnabled() {
            return true;
        }
    }
}

```

- ê¸°ì¡´ì—ëŠ” loadUserByUsername() ë©”ì„œë“œì˜ ë¦¬í„´ ê°’ìœ¼ë¡œ <br/> new User(findMember.getEmail(), findMember.getPassword(), authorities);ì„ ë¦¬í„´í–ˆì§€ë§Œ<br/> ê°œì„ ëœ ì½”ë“œì—ì„œëŠ” (1)ê³¼ ê°™ì´ new HelloUserDetails(findMember);ë¼ëŠ” <br/> Custom UserDetails í´ë˜ìŠ¤ì˜ ìƒì„±ìë¡œ findMemberë¥¼ ì „ë‹¬
- (2)ì˜ HelloUserDetails í´ë˜ìŠ¤ëŠ” UserDetails ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆê³  <br/> ë˜í•œ Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ê³  ìˆë‹¤.
    - loadUserByUsername() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œë„ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°.<br/> â‡’ Collection<? extends GrantedAuthority> authorities = authorityUtils.createAuthorities(findMember);ë„<br/> HelloUserDetails í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ì´ë™

ğŸ’¡ ì´ë ‡ê²Œ êµ¬ì„±í•˜ë©´ **ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ íšŒì› ì •ë³´ë¥¼ Spring Securityì˜ User ì •ë³´ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •**ê³¼ **Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •**ì„ **ìº¡ìŠí™”**í•  ìˆ˜ ìˆë‹¤.

ğŸ’¡ ë˜í•œ `HelloUserDetails` í´ë˜ìŠ¤ëŠ” `Member` ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ê³  ìˆìœ¼ë¯€ë¡œ HelloUserDetailsë¥¼ ë¦¬í„´ ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œëŠ” ë‘ ê°œ í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ëª¨ë‘ ë‹¤ ì†ì‰½ê²Œ ìºìŠ¤íŒ…í•´ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤

(2-3)ì—ì„œëŠ” `HelloAuthorityUtils`ì˜ `createAuthorities()` ë©”ì„œë“œë¥¼ ì´ìš©í•´ Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ìƒì„±

ì´ ì½”ë“œëŠ” ê¸°ì¡´ì—ëŠ” loadUserByUsername() ë©”ì„œë“œ ë‚´ë¶€ì— ìˆì—ˆì§€ë§Œ ì§€ê¸ˆì€ `HelloUserDetails` í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ë„ë¡ ìº¡ìŠí™”ë˜ì—ˆë‹¤.

- (2-4)ì—ì„œëŠ” Spring Securityì—ì„œ ì¸ì‹í•  ìˆ˜ ìˆëŠ” usernameì„ Member í´ë˜ìŠ¤ì˜ email ì£¼ì†Œë¡œ ì±„ìš°ê³  ìˆê¸° ë•Œë¬¸ì— <br/> `getUsername()`ì˜ **ë¦¬í„´ ê°’ì€ nullì¼ ìˆ˜ ì—†ë‹¤.**
- ê¸°íƒ€ UserDetails ì¸í„°í˜ì´ìŠ¤ì˜ ì¶”ìƒ ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ë¶€ë¶„ì€ ì§€ê¸ˆì€ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šì€ ë¶€ë¶„ì´ë¯€ë¡œ ëª¨ë‘ `true`ê°’ì„ ë¦¬í„´í•˜ê²Œ í–ˆë‹¤.


### 6ï¸âƒ£ Userì˜ Roleì„ DBì—ì„œ ê´€ë¦¬í•˜ê¸°

- ì¼ë°˜ì ìœ¼ë¡œ Userì˜ ì¸ì¦ ì •ë³´ ê°™ì€ ë³´ì•ˆê³¼ ê´€ë ¨ëœ ì •ë³´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê°™ì€ ì˜êµ¬ ì €ì¥ì†Œì— ì•ˆì „í•˜ê²Œ ë³´ê´€
- but, í˜„ì¬ê¹Œì§€ Userì˜ ê¶Œí•œ ì •ë³´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼<br/> ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ User ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì½”ë“œìƒì—ì„œ ì¡°ê±´ì— ë§ê²Œ ìƒì„±
- Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì • í•„ìš”
    - Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í…Œì´ë¸” ìƒì„±
    - íšŒì› ê°€ì… ì‹œ, Userì˜ ê¶Œí•œ ì •ë³´(Role)ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ì‘ì—…
    - ë¡œê·¸ì¸ ì¸ì¦ ì‹œ, Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•˜ëŠ” ì‘ì—…

1. **Userì˜ ê¶Œí•œ ì •ë³´ í…Œì´ë¸” ìƒì„±**
    - ê¶Œí•œê´€ë ¨ ì •ë³´ëŠ” ì‹¤ë¬´ì—ì„œ ì‹¤ì œë¡œ í…Œì´ë¸”ì„ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•œë‹¤.<br/>(ê¸°ë³¸í‚¤ 1ë²ˆì€ admin ë‚˜ë¨¸ì§€ëŠ” user)
    - í•˜ë‚˜ì˜ ë©¤ë²„ëŠ” í•˜ë‚˜ì˜ ê¶Œí•œ? no . í•˜ë‚˜ì˜ ê¶Œí•œì€ í•˜ë‚˜ì˜ ë©¤ë²„ë§Œ? no â‡’ ë‹¤ëŒ€ë‹¤
    - ê·¸ëŸ¬ë‚˜ ì¼ëŒ€ë‹¤ë¡œ êµ¬í˜„í•  ì˜ˆì •ì„, memberëŠ” ìŠ¤í”„ì‹œíë¦¬í‹°ê°€ ê´€ë¦¬í•˜ê¸°ë•Œë¬¸ì— ë©¤ë²„ì—ê²Œì„œë§Œ ê´€ê³„êµ¬í˜„ í•˜ë©´ ë¨.
    - **Memberì— ì½”ë“œ ì¶”ê°€**
        
        ```java
        @ElementCollection(fetch = FetchType.EAGER)
        //ê¶Œí•œ ê´€ë ¨ í…Œì´ë¸”ì— ì„¤ì • -> ì• ë„ˆí…Œì´ì…˜ë§Œ ë‹¬ì•„ë„ ìë™ìœ¼ë¡œ í…Œì´ë¸”ì´ ìƒì„±ë¨.
        ```
        
        - List, Set ê°™ì€ ì»¬ë ‰ì…˜ íƒ€ì…ì˜ í•„ë“œëŠ” `@ElementCollection` ì• ë„ˆí…Œì´ì…˜ì„ ì¶”ê°€í•˜ë©´ <br/> User ê¶Œí•œ ì •ë³´ì™€ ê´€ë ¨ëœ ë³„ë„ì˜ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ê°„ë‹¨í•˜ê²Œ ë§¤í•‘ ì²˜ë¦¬ê°€ ëœë‹¤.
        - ì´ëŒ€ë¡œ ì‹¤í–‰í•˜ë©´ ìë™ìœ¼ë¡œ í…Œì´ë¸” ìƒì„± ë˜ì–´ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.
            
            <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/24447078-3e4e-4cbc-bba9-927c10b3c0e9"/>
            
        
2. **íšŒì› ê°€ì… ì‹œ, Userì˜ ê¶Œí•œ ì •ë³´(Role)ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥**
    
    **ğŸ“Œ DBMemberService**
    
    ```java
    @Transactional
    public class DBMemberService implements MemberService {
        ...
        private final HelloAuthorityUtils authorityUtils;
        ...
        public Member createMember(Member member) {
            verifyExistsEmail(member.getEmail());
            String encryptedPassword = passwordEncoder.encode(member.getPassword());
            member.setPassword(encryptedPassword);
    
            // (1) Roleì„ DBì— ì €ì¥
            List<String> roles = authorityUtils.createRoles(member.getEmail());
            member.setRoles(roles);
    
            Member savedMember = memberRepository.save(member);
    
            return savedMember;
        }
    
        ...
        ...
    }
    
    ```
    
    **ğŸ“Œ`createRoles()` ë©”ì„œë“œê°€ ì¶”ê°€ëœ `HelloAuthorityUtils` í´ë˜ìŠ¤ì˜ ì½”ë“œ**
    
    ```java
    package com.springboot.utils;
    
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.security.core.GrantedAuthority;
    import org.springframework.security.core.authority.AuthorityUtils;
    import org.springframework.security.core.authority.SimpleGrantedAuthority;
    import org.springframework.stereotype.Component;
    
    import java.util.List;
    import java.util.stream.Collectors;
    
    @Component
    public class HelloAuthorityUtils {
        @Value("${mail.address.admin}")
        private String adminMailAddress;
        private final List<GrantedAuthority> ADMIN_ROLES= AuthorityUtils.createAuthorityList("ROLE_ADMIN", "ROLE_USER");
        private final List<GrantedAuthority> USER_ROLES =AuthorityUtils.createAuthorityList("ROLE_USER");
        private final List<String> ADMIN_ROLES_STRING = List.of("ADMIN", "USER");
        private final List<String> USER_ROLES_STRING = List.of("USER");
    
        //ë©”ëª¨ë¦¬ì˜ roleì„ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œ ì •ë³´ ìƒì„±
        public List<GrantedAuthority> createAuthorities(String email){
            if(email.equals(adminMailAddress)){
                return ADMIN_ROLES;
            }else {
                return USER_ROLES;
            }
        }
    
        //DBì— ì €ì¥ëœ Rolseë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œ ì •ë³´ ìƒì„±
        public List<GrantedAuthority>createAuthorities(List<String> roles){
            List<GrantedAuthority> authorities = roles.stream().map(role-> new SimpleGrantedAuthority("ROLE_"+role))
                    .collect(Collectors.toList());
            return authorities;
        }
    
        //DBì— ì €ì¥í•˜ê¸° ìœ„í•œ í˜•íƒœì˜ rolesë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ
        public List<String>createRoles(String email) {
            if (email.equals(adminMailAddress)) {
                return ADMIN_ROLES_STRING;
            } else {
                return USER_ROLES_STRING;
            }
        }
    }
    ```
    
    **ğŸ“Œ  ë¡œê·¸ì¸ ì¸ì¦ ì‹œ, Userì˜ ê¶Œí•œ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•˜ëŠ” ì‘ì—…**
    
    ```java
    @Component
    public class HelloUserDetailsServiceV3 implements UserDetailsService {
    		...
    		
        private final class HelloUserDetails extends Member implements UserDetails {
            HelloUserDetails(Member member) {
                setMemberId(member.getMemberId());
                setFullName(member.getFullName());
                setEmail(member.getEmail());
                setPassword(member.getPassword());
                setRoles(member.getRoles());        // (1)
            }
    
            @Override
            public Collection<? extends GrantedAuthority> getAuthorities() {
                // (2) DBì— ì €ì¥ëœ Role ì •ë³´ë¡œ User ê¶Œí•œ ëª©ë¡ ìƒì„±
                return authorityUtils.createAuthorities(this.getRoles());
            }
            ...
            ...
        }
    }
    
    ```
    
    - (1) : HelloUserDetailsê°€ ìƒì†í•˜ê³  ìˆëŠ” Member(`extends Member`)ì— ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ `List<String> roles`ë¥¼ ì „ë‹¬
    - (2) :  ë‹¤ì‹œ Member(`extends Member`)ì— ì „ë‹¬í•œ Role ì •ë³´ë¥¼ authorityUtils.createAuthorities() ë©”ì„œë“œì˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì„œ<br/> ê¶Œí•œ ëª©ë¡(`List<GrantedAuthority>`)ì„ ìƒì„±
    - `createAuthorities(List<String> roles)` ë©”ì„œë“œê°€ ì¶”ê°€ëœ `HelloAuthorityUtils` í´ë˜ìŠ¤
        
        ```java
        ...
        
        @Component
        public class HelloAuthorityUtils {
            @Value("${mail.address.admin}")
            private String adminMailAddress;
        
            private final List<GrantedAuthority> ADMIN_ROLES = AuthorityUtils.createAuthorityList("ROLE_ADMIN", "ROLE_USER");
            private final List<GrantedAuthority> USER_ROLES = AuthorityUtils.createAuthorityList("ROLE_USER");
            private final List<String> ADMIN_ROLES_STRING = List.of("ADMIN", "USER");
            private final List<String> USER_ROLES_STRING = List.of("USER");
        
            // ë©”ëª¨ë¦¬ ìƒì˜ Roleì„ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œ ì •ë³´ ìƒì„±.
            public List<GrantedAuthority> createAuthorities(String email) {
                if (email.equals(adminMailAddress)) {
                    return ADMIN_ROLES;
                }
                return USER_ROLES;
            }
        
            // (1) DBì— ì €ì¥ëœ Roleì„ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œ ì •ë³´ ìƒì„±
            public List<GrantedAuthority> createAuthorities(List<String> roles) {
               List<GrantedAuthority> authorities = roles.stream()
                       .map(role -> new SimpleGrantedAuthority("ROLE_" + role)) // (2)
                       .collect(Collectors.toList());
               return authorities;
            }
        
            ...
            ...
        }
        
        ```
        
        **ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì§€ê³  ì˜¨ Role ëª©ë¡(`List<String> roles`)ì„ ê·¸ëŒ€ë¡œ ì´ìš©í•´ì„œ ê¶Œí•œ ëª©ë¡(`authorities`)ì„ ë§Œë“ ë‹¤.**
        
        ğŸ’¡ ì£¼ì˜í•´ì•¼ í•  ê²ƒ :  (2)ì™€ ê°™ì´ `SimpleGrantedAuthority` ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ìƒì„±ì íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ëŠ” ê°’ì´<br/> â€œ `USER`"  ë˜ëŠ” â€œ`ADMIN`"ìœ¼ë¡œ ë„˜ê²¨ì£¼ë©´ ì•ˆ ë˜ê³  â€œ`ROLE_USER`" ë˜ëŠ” â€œ`ROLE_ADMIN`" í˜•íƒœë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤
        
    
### 7ï¸âƒ£ Custom AuthenticationProviderë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
    
- Custom UserDetailsServiceë¥¼ ì‚¬ìš©í•´ ë¡œê·¸ì¸ ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì€ **Spring Securityê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì¸ì¦ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ ì£¼ëŠ” ë°©ì‹**
 - **Custom AuthenticationProvider**ë¥¼ ì´ìš©í•´ ìš°ë¦¬ê°€ ì§ì ‘ ë¡œê·¸ì¸ ì¸ì¦ì„ ì²˜ë¦¬í•  ê²ƒ.
        
        
    1. **HelloUserAuthenticationProvider í´ë˜ìŠ¤**
        - **AuthenticationProviderë¥¼ êµ¬í˜„í•œ êµ¬í˜„ í´ë˜ìŠ¤ê°€ Spring Beanìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆë‹¤ë©´<br/> í•´ë‹¹ AuthenticationProviderë¥¼ ì´ìš©í•´ì„œ ì¸ì¦ì„ ì§„í–‰**
            - ë”°ë¼ì„œ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ ë¡œê·¸ì¸ ì¸ì¦ì„ ì‹œë„í•˜ë©´ ìš°ë¦¬ê°€ êµ¬í˜„í•œ HelloUserAuthenticationProviderê°€ ì§ì ‘ ì¸ì¦ì„ ì²˜ë¦¬
        
        ```java
        package com.springboot.utils;
        
        import com.springboot.auth.HelloUserDetailsServiceV2;
        import org.springframework.security.authentication.AuthenticationProvider;
        import org.springframework.security.authentication.BadCredentialsException;
        import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
        import org.springframework.security.core.Authentication;
        import org.springframework.security.core.AuthenticationException;
        import org.springframework.security.core.GrantedAuthority;
        import org.springframework.security.core.userdetails.UserDetails;
        import org.springframework.security.core.userdetails.UsernameNotFoundException;
        import org.springframework.security.crypto.password.PasswordEncoder;
        import org.springframework.stereotype.Component;
        
        import java.util.Collection;
        import java.util.Optional;
        
        @Component
        public class HelloUserAuthenticationProvider implements AuthenticationProvider {
            private final HelloUserDetailsServiceV2 helloUserDetailsServiceV2;
            private final PasswordEncoder passwordEncoder;
        
            public HelloUserAuthenticationProvider(HelloUserDetailsServiceV2 helloUserDetailsServiceV2, PasswordEncoder passwordEncoder) {
                this.helloUserDetailsServiceV2 = helloUserDetailsServiceV2;
                this.passwordEncoder = passwordEncoder;
            }
        
            @Override
            public Authentication authenticate(Authentication authentication) throws AuthenticationException {
                UsernamePasswordAuthenticationToken authToken = (UsernamePasswordAuthenticationToken) authentication;
                String username = authToken.getName();
        
                Optional.ofNullable(username).orElseThrow(()-> new UsernameNotFoundException("Invalid User name or User Password"));
               
               // (2) íšŒì›ê°€ì…ì„ í•˜ì§€ ì•Šê³  ë¡œê·¸ì¸í•˜ë©´ ìƒê¸°ëŠ” ë¬¸ì œì  ê°œì„ 
                try {
                    UserDetails userDetails = helloUserDetailsServiceV2.loadUserByUsername(username);
                    String password = userDetails.getPassword();
                    //ì•”í˜¸í™” ì•ˆë˜ì–´ìˆìŒ
                    
                    
                    verifyCredentials(authToken.getCredentials(), password);
                    //ë¡œê·¸ì¸ ì •ë³´ì— í¬í•¨ëœ íŒ¨ìŠ¤ì›Œë“œì™€ DBì— ì €ì¥ëœ íŒ¨ìŠ¤ì›Œë“œ ì •ë³´ê°€ ì¼ì¹˜í•˜ëŠ”ì¦
                    //verifyCredentials ì—ì„œ ì•”í˜¸í™” ì´ë£¨ì–´ì§(ë‹¨ë°©í–¥ ì•”í˜¸í™” - ì¼ë°˜ì ìœ¼ë¡œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥)
        
                    Collection<? extends GrantedAuthority> authorities = userDetails.getAuthorities();
                    return UsernamePasswordAuthenticationToken.authenticated(username, password, authorities);
                }catch (Exception e){
                    throw new UsernameNotFoundException(e.getMessage());
                }
            }
            
            //supportë©”ì„œë“œëŠ” ìš°ë¦¬ê°€ ë§Œë“  í”„ë¡œë°”ì´ë”ê°€ Userê¸°ë°˜ì˜ password ë°©ì‹ì´ë¼ê³  ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ì•Œë ¤ì£¼ëŠ” ê²ƒ,
            // ì• ì´ˆì— êµ¬í˜„ë˜ì–´ ìˆëŠ” ë©”ì„œë“œë¼ì„œ ë°©ì‹ì— ë§ì¶°ì„œ ì‚¬ìš©í•˜ê¸°.
            //supports() ë©”ì„œë“œì˜ ë¦¬í„´ê°’ì´ trueì¼ ê²½ìš°, Spring SecurityëŠ” í•´ë‹¹ AuthenticationProviderì˜ authenticate() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ì¸ì¦ì„ ì§„í–‰
            @Override
            public boolean supports(Class<?> authentication) {
                return UsernamePasswordAuthenticationToken.class.equals(authentication);
            }
        
            private void verifyCredentials(Object credentials, String password){
                if(!passwordEncoder.matches((String) credentials, password)){
                    //ì¸ì½”ë”© í•œë‹¤ìŒì— ë‘˜ë‹¤ ì•”í˜¸í™”ë¥¼ í•œë‹¤.(ë‹¨ë°©í–¥ ì•”í˜¸í™” - ì¼ë°˜ì ìœ¼ë¡œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥)
                    // ê°™ìœ¼ë©´ true, ë‹¤ë¥´ë©´ false
                    throw new BadCredentialsException("Invaild User name or User Password");
                }
            }
        }
        
        ```
        
    
    1. Custom AuthenticationProviderë¥¼ ì´ìš©í•  ê²½ìš° íšŒì›ê°€ì… ì „ ë¡œê·¸ì¸ í•˜ë©´ ë‚˜íƒ€ëŠ” ë¬¸ì œì 
        - íšŒì›ê°€ì…ì„ í•˜ì§€ ì•Šì€ ì±„ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚œë‹¤.
            
            <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/dfa64f54-d2e5-4a01-9be5-8e07fcb7f33f"/>
            
        - ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ì„œ BusinessLogicExceptionì„ ì²˜ë¦¬í•˜ì§€ ëª»í•¨.
        - filterChainì˜ ê°€ì¥ ëê¹Œì§€ ì˜¬ë¼ê°„ í›„ ì„œë¸”ë¦¿ì„ ì§€ë‚˜ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ìµœìƒë‹¨ìœ¼ë¡œ ê°€ê²Œ ë¨â‡’ ì¦‰, í†°ìº£ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ì´ë‹¤
        
        ê°œì„ í•˜ë ¤ë©´ .Cusotm AuthenticationProviderì—ì„œ Exceptionì´ ë°œìƒí•  ê²½ìš°, ì´ Exceptionì„ catch í•´ì„œ **AuthenticationExceptionìœ¼ë¡œ rethrowë¥¼ í•´ì£¼ë©´ ëœë‹¤.<Br/> â‡’**(2) ì—ì„œ try-catchë¡œ ê°ì‹¼ ì´ìœ ëŠ” ì˜ˆì™¸ë¥¼ ë˜ì ¸ ê°œì„ í•˜ê¸°í•¨