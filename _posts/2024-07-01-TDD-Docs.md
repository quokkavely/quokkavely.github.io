---
layout : single
title : "[Testing] TDD/ API ë¬¸ì„œí™”"
categories: Spring
tag : [Spring, ê°œë…, JPA, Testing]
author_profile: true
---


ğŸ“Œ ê°œì¸ì ì¸ ê³µê°„ìœ¼ë¡œ ê³µë¶€ë¥¼ ê¸°ë¡í•˜ê³  ë³µìŠµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. <br>
ì •í™•í•˜ì§€ ì•Šì€ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ :ğŸ˜¸ <br>
[í‹€ë¦° ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ë³µë°›ìœ¼ì‹¤ê±°ì—ìš”]  
{: .notice--primary}


# TDD(Test Driven Development, í…ŒìŠ¤íŠ¸ ì£¼ë„ê°œë°œ)

TDDì˜ ê°œë…ì„ í•œë§ˆë””ë¡œ ìš”ì•½í•˜ìë©´ â€˜í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € í•˜ê³  êµ¬í˜„ì€ ê·¸ë‹¤ìŒì— í•œë‹¤â€™ì´ë‹¤.

TDDëŠ” ëª¨ë“  ì‘ì—… ì´ì „ì— í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì €í•œë‹¤.

1. ì´í•´ ë‹¹ì‚¬ìë“¤ ê°„ì— ìˆ˜ì§‘ëœ ìš”êµ¬ ì‚¬í•­ê³¼ ì„¤ê³„ëœ í™”ë©´(UI ì„¤ê³„ì„œ ë“±) ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ë„ë©”ì¸ ëª¨ë¸ì„ ë„ì¶œí•©ë‹ˆë‹¤.
2. ë„ì¶œëœ ë„ë©”ì¸ ëª¨ë¸ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ë“¤ì´ëŠ” ì—”ë“œí¬ì¸íŠ¸ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë°ì´í„° ì•¡ì„¸ìŠ¤ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ ë“±ì„ ì„¤ê³„í•´ì„œ í° ê·¸ë¦¼ì„ ê·¸ë ¤ë´…ë‹ˆë‹¤.
3. í´ë˜ìŠ¤ ì„¤ê³„ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ í° ê·¸ë¦¼ì„ ê·¸ë ¤ë³´ì•˜ë‹¤ë©´ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ì˜ í° í‹€ì„ ì‘ì„±í•©ë‹ˆë‹¤.
4. í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ì˜ í° í‹€ì´ ì‘ì„±ë˜ì—ˆë‹¤ë©´ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ ë‚´ì— ë©”ì„œë“œë¥¼ ì •ì˜í•˜ë©´ì„œ ì„¸ë¶€ ë™ì‘ì„ ê³ ë¯¼í•˜ê³ , ì½”ë“œë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.
5. í•´ë‹¹ ë©”ì„œë“œì˜ ê¸°ëŠ¥ êµ¬í˜„ì´ ëë‚¬ë‹¤ë©´ êµ¬í˜„í•œ ê¸°ëŠ¥ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
6. í…ŒìŠ¤íŠ¸ì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´ êµ¬í˜„í•œ ì½”ë“œë¥¼ ë””ë²„ê¹…í•˜ë©´ì„œ ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ìŠµë‹ˆë‹¤.

âœ”ï¸ TDD ê´€ì ì—ì„œ ë‘ë“œëŸ¬ì§€ëŠ” ì  í•œ ê°€ì§€ëŠ” 3ë²ˆ ~ 6ë²ˆì˜ ê³¼ì •ì—ì„œ êµ¬í˜„ì´ ë¨¼ì €ê³ , í…ŒìŠ¤íŠ¸ê°€ ë‚˜ì¤‘ì´ë¼ëŠ” ì 

âœ”ï¸ TDDë¥¼ ì˜í–ˆì„ ë•ŒëŠ” 6ë²ˆì´ ì¤„ì–´ë“¤ê¸´ í•˜ëŠ”ë° í•´ì™¸ì—ì„œë„ ê·¸ë ‡ê³  ë³µì¡ë„ë§Œ ì˜¬ë¼ê°€ì§€ í¬ê²Œ ì¥ì ì´ ì—†ì–´ì„œ ì‚¬ìš©ì„ í•˜ì§€ ì•ŠëŠ” ì¶”ì„¸ë¼ê³  í•¨.

â­ TDDì˜ ê°œë°œ ë°©ì‹ì€ â€˜**`ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ â†’ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì„±ê³µí•  ë§Œí¼ì˜ ê¸°ëŠ¥ êµ¬í˜„ â†’ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ â†’ ë¦¬íŒ©í† ë§ â†’ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ì™€ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ í™•ì¸`**â€™ì´ë¼ëŠ” íë¦„ì„ ë°˜ë³µí•œë‹¤.

## TDDì˜ íŠ¹ì§• ì •ë¦¬

- TDDëŠ” ëª¨ë“  ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì§„í–‰í•œ ë’¤ì— ì¡°ê±´ì— ë§Œì¡±í•˜ì§€ ì•ŠëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ì§„í–‰í•˜ë©´ì„œ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì ì§„ì ìœ¼ë¡œ ì„±ê³µì‹œí‚¨ë‹¤.
- **TDDëŠ” í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ê°€ â€œ`failed`â€ì¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì§€ì†ì ìœ¼ë¡œ ê·¸ë¦¬ê³  ë‹¨ê³„ì ìœ¼ë¡œ ìˆ˜ì •í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰ ê²°ê³¼ê°€ â€œ`passed`â€ê°€ ë˜ë„ë¡ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤.**
- TDDëŠ” í…ŒìŠ¤íŠ¸ê°€ â€œ`passed`â€ ë  ë§Œí¼ì˜ ì½”ë“œë§Œ ìš°ì„  ì‘ì„±í•œë‹¤.
- TDDëŠ” â€˜**`ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ â†’ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì„±ê³µí•  ë§Œí¼ì˜ ê¸°ëŠ¥ êµ¬í˜„ â†’ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ â†’ ë¦¬íŒ©í† ë§ â†’ ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ì™€ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ í™•ì¸`**â€™ì´ë¼ëŠ” íë¦„ì„ ë°˜ë³µ

ì•ì—ì„œ TDD ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•œ íŒ¨ìŠ¤ì›Œë“œ ìœ íš¨ì„± ê²€ì¦ ê¸°ëŠ¥ì˜ êµ¬í˜„ì— ëŒ€í•œ ì„¤ëª… ìì²´ëŠ” ê¸¸ì§€ë§Œ ì‹¤ì œ TDD ë°©ì‹ìœ¼ë¡œ ì˜ ì§„í–‰ëœë‹¤ë©´ í…ŒìŠ¤íŠ¸ì™€ ê¸°ëŠ¥ êµ¬í˜„, ë¦¬íŒ©í† ë§ê¹Œì§€ ë¹ ë¥´ê²Œ ì§„í–‰ì´ ê°€ëŠ¥.

# API ë¬¸ì„œí™”

- **API ë¬¸ì„œí™”ë€ í´ë¼ì´ì–¸íŠ¸ê°€ REST API ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìš”ì²­ì„ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œ ì•Œì•„ì•¼ ë˜ëŠ” ìš”ì²­ ì •ë³´(ìš”ì²­ URL(ë˜ëŠ” URI), request body, query parameter ë“±)ë¥¼ ë¬¸ì„œë¡œ ì˜ ì •ë¦¬í•˜ëŠ” ê²ƒì„ ì˜ë¯¸**
- REST API ê¸°ë°˜ì˜ ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ API ì‚¬ìš©ì„ ìœ„í•œ ì–´ë–¤ ì •ë³´ê°€ í•„ìš”í•¨ â†’ API ì‚¬ìš©ì„ ìœ„í•œ ì–´ë–¤ ì •ë³´ê°€ ë‹´ê²¨ ìˆëŠ” ë¬¸ì„œë¥¼ API ë¬¸ì„œ ë˜ëŠ” API ìŠ¤í™(ì‚¬ì–‘, Specification)
- ê°œë°œì´ ë“¤ì–´ê°€ê¸°ì „ì— ë¬¸ì„œê°€ ë‚˜ì™€ì•¼ í•¨ â†’ ê¸°íšë‹¨ê³„ì—ì„œ ì„¤ê³„ë¥¼ í•¨.

## Spring Rest Docs vs Swagger

### Swagger

1. íŠ¹ì§•
    - ì• ë„ˆí…Œì´ì…˜ ê¸°ë°˜ì˜ API ë¬¸ì„œí™” ë°©
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì— ë¬¸ì„œí™”ë¥¼ ìœ„í•œ ì• ë„ˆí…Œì´ì…˜ë“¤ì´ í¬í•¨ëœë‹¤.
    - API ë¬¸ì„œì™€ API ì½”ë“œ ê°„ì˜ ì •ë³´ ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
    - API íˆ´ë¡œì¨ì˜ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.
    - ë¬¸ì„œí™” ë¿ë§Œ ì•„ë‹ˆë¼ í…ŒìŠ¤íŠ¸ íˆ´ì˜ ê¸°ëŠ¥ ìˆê³  UIê°€ ê¹”ë”í•´ì„œ ë¬¸ì„œë¥¼ í†µí•´ í™•ì¸í•˜ê¸° ì¢‹ìŒ.
    - BUT, ê¸°ëŠ¥ë³„ ë¶„ë¦¬ê°€ ì•ˆë˜ê³  ê°€ë…ì„± ë° ìœ ì§€ ë³´ìˆ˜ì„±ì´ ë–¨ì–´ì§„ë‹¤.
    - ë°°í¬ì‹œì ì— ì½”ë“œê°€ ë“¤ì–´ê°€ê²Œ ëœë‹¤. â†’ ì£¼ì„ê³¼ ë¡œê·¸ë¥¼ í¬í•¨ì‹œí‚¤ì§€ ì•ŠëŠ” ê²ƒì´ ì¼ë°˜ì ì¸ë° ë°°í¬í• ë•ŒëŠ” ë¬¸ì„œê°€ í•„ìš”ì—†ëŠ”ë° ì¼ì¼ì´ ë²—ê²¨ë‚´ì•¼í•œë‹¤.
2. ì˜ˆì œ 
    1. Controller â†’  ë¬´ìˆ˜íˆ ë§ì€ ì• ë„ˆí…Œì´ì…˜ 
        
        ```java
        @ApiOperation(value = "íšŒì› ì •ë³´ API", tags = {"Member Controller"}) // (1)
        @RestController
        @RequestMapping("/v11/swagger/members")
        @Validated
        @Slf4j
        public class MemberControllerSwaggerExample {
            private final MemberService memberService;
            private final MemberMapper mapper;
        
            public MemberControllerSwaggerExample(MemberService memberService, MemberMapper mapper) {
                this.memberService = memberService;
                this.mapper = mapper;
            }
        
            // (2)
            @ApiOperation(value = "íšŒì› ì •ë³´ ë“±ë¡", notes = "íšŒì› ì •ë³´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.")
        
            // (3)
            @ApiResponses(value = {
                    @ApiResponse(code = 201, message = "íšŒì› ë“±ë¡ ì™„ë£Œ"),
                    @ApiResponse(code = 404, message = "Member not found")
            })
            @PostMapping
            public ResponseEntity postMember(@Valid @RequestBody MemberDto.Post memberDto) {
                Member member = mapper.memberPostToMember(memberDto);
                member.setStamp(new Stamp()); // homework solution ì¶”ê°€
        
                Member createdMember = memberService.createMember(member);
        
                return new ResponseEntity<>(
                        new SingleResponseDto<>(mapper.memberToMemberResponse(createdMember)),
                        HttpStatus.CREATED);
            }
        
            ...
            ...
        
            // (4)
            @ApiOperation(value = "íšŒì› ì •ë³´ ì¡°íšŒ", notes = "íšŒì› ì‹ë³„ì(memberId)ì— í•´ë‹¹í•˜ëŠ” íšŒì›ì„ ì¡°íšŒí•©ë‹ˆë‹¤.")
            @GetMapping("/{member-id}")
            public ResponseEntity getMember(
                    @ApiParam(name = "member-id", value = "íšŒì› ì‹ë³„ì", example = "1")  // (5)
                    @PathVariable("member-id") @Positive long memberId) {
                Member member = memberService.findMember(memberId);
                return new ResponseEntity<>(
                        new SingleResponseDto<>(mapper.memberToMemberResponse(member))
                                            , HttpStatus.OK);
            }
        
            ...
            ...
        }
        
        ```
        
    2. DTO, Request Bodyë‚˜ Response Body ê°™ì€ DTO í´ë˜ìŠ¤ì—ë„ ì•„ë˜ì˜ ì½”ë“œì™€ ê°™ì´ Swaggerì˜ ì• ë„ˆí…Œì´ì…˜ì„ ì¼ì¼ì´ ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•¨.
        
        ```java
        @ApiModel("Member Post")  // (1)
        @Getter
        public class MemberPostDto {
            // (2)
            @ApiModelProperty(notes = "íšŒì› ì´ë©”ì¼", example = "hgd@gmail.com", required = true)
            @NotBlank
            @Email
            private String email;
        
            // (3)
            @ApiModelProperty(notes = "íšŒì› ì´ë¦„", example = "í™ê¸¸ë™", required = true)
            @NotBlank(message = "ì´ë¦„ì€ ê³µë°±ì´ ì•„ë‹ˆì–´ì•¼ í•©ë‹ˆë‹¤.")
            private String name;
        
            // (4)
            @ApiModelProperty(notes = "íšŒì› íœ´ëŒ€í° ë²ˆí˜¸", example = "010-1111-1111", required = true)
            @Pattern(regexp = "^010-\\\\d{3,4}-\\\\d{4}$",
                    message = "íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 010ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 11ìë¦¬ ìˆ«ìì™€ '-'ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.")
            private String phone;
        }
        
        ```
        
3.  Swagger API ë¬¸ì„œ í™”ë©´ ì˜ˆ
    
    Postmanì—ì„œ MemberControlleì— HTTP ìš”ì²­ì„ ì „ì†¡í•˜ë“¯ì´ [Execute] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ MemberControllerì— ìš”ì²­ì„ ì „ì†¡ê°€ëŠ¥
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/11472d29-62e8-45e1-ad5b-a1809681adbe" width=400/>
    

### **Spring Rest Docs**

1. íŠ¹ì§•
    - í…ŒìŠ¤íŠ¸ ì½”ë“œ ê¸°ë°˜ì˜ API ë¬¸ì„œí™” ë°©ì‹
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì— ë¬¸ì„œí™”ë¥¼ ìœ„í•œ ì •ë³´ë“¤ì´ í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.
    - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ ì‹¤í–‰ì´ â€œpassedâ€ì—¬ì•¼ API ë¬¸ì„œê°€ ìƒì„±ëœë‹¤.
    - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë°˜ë“œì‹œ ì‘ì„±í•´ì•¼ ëœë‹¤.
    - API íˆ´ë¡œì¨ì˜ ê¸°ëŠ¥ì€ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.
    
2. ì˜ˆì œ
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/1b7cfce3-bb68-47c8-9e31-e3a069aa5b49" />
    
    - ì½”ë“œì˜ ë…¸ë€ ë°•ìŠ¤ë¶€ë¶„ì´ ë¬¸ì„œí™” ê´€ë ¨ì½”ë“œì´ë‹¤.
    - í…ŒìŠ¤íŠ¸ ì½”ë“œ ê²€ì¦ì— ë¬¸ì„œí™” ì½”ë“œì— í¬í•¨ë˜ì–´ ìˆìŒ.â†’ ê·¸ë ‡ê²Œ ë•Œë¬¸ì— ë¬¸ì„œí™”í•˜ë ¤ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ í•„ìˆ˜
3. **Spring Rest Docsì˜** API ë¬¸ì„œí™”ë©´ ì˜ˆ
    
    <img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/a4be3c86-5ed3-472e-a661-aa15fb930030" width=400/>
    

## Spring Rest Docs

### Spring Rest Docsì˜ API ë¬¸ì„œ ìƒì„± íë¦„

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/9c7b04e8-8078-4674-9bbc-bdf38f5d4581" width=300/>

1. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**
    1. ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
    â…°. Spring Rest DocsëŠ” Controllerì˜ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ì™€ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìŒ
    2. API ìŠ¤í™ ì •ë³´ ì½”ë“œ ì‘ì„±
    â…°. ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë‹¤ìŒì— Controllerì— ì •ì˜ë˜ì–´ ìˆëŠ” API ìŠ¤í™ ì •ë³´(Request Body, Response Body, Query Parameter ë“±)ë¥¼ ì½”ë“œë¡œ ì‘ì„±
2. **test íƒœìŠ¤í¬(task) ì‹¤í–‰**
    1. ì‘ì„±ëœ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.
    â…°. í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì‹¤í–‰ì‹œì¼œë„ ë˜ì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œ Gradleì˜ ë¹Œë“œ íƒœìŠ¤í¬(task)ì¤‘ í•˜ë‚˜ì¸ test taskë¥¼ ì‹¤í–‰ì‹œì¼œì„œ API ë¬¸ì„œ ìŠ¤ë‹ˆí«(snippet)ì„ ì¼ê´„ ìƒì„±í•œë‹¤. 
    2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ê°€ â€œ`passed`â€ì´ë©´ ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•˜ê³ , â€œ`failed`â€ì´ë©´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ìˆ˜ì •í•œ í›„, ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì•¼ í•œë‹¤. â†’í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•´ì•¼ ë¬¸ì„œ ì‘ì—… ê°€ëŠ¥.
3. **API ë¬¸ì„œ ìŠ¤ë‹ˆí«( .adoc íŒŒì¼) ìƒì„±**
    1. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ê°€ â€œ`passed`â€ì´ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œì— í¬í•¨ëœ API ìŠ¤í™ ì •ë³´ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ API ë¬¸ì„œ ìŠ¤ë‹ˆí«ì´  `.adoc` í™•ì¥ìë¥¼ ê°€ì§„ íŒŒì¼ë¡œ ìƒì„±ëœë‹¤.
    

> **ìŠ¤ë‹ˆí«ì´ë€?**
ìŠ¤ë‹ˆí«ì€ **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ ìŠ¤ë‹ˆí«ì´ ìƒì„±**ë˜ë©°, ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë‹ˆí«ì„ ëª¨ì•„ì„œ í•˜ë‚˜ì˜ API ë¬¸ì„œë¥¼ ìƒì„± ê°€ëŠ¥í•˜ë‹¤.
**API ë¬¸ì„œ ìƒì„±**
> 
> 1. ìƒì„±ëœ API ë¬¸ì„œ ìŠ¤ë‹ˆí«ì„ ëª¨ì•„ì„œ í•˜ë‚˜ì˜ API ë¬¸ì„œë¡œ ìƒì„±í•©ë‹ˆë‹¤.
> 2. **API ë¬¸ì„œë¥¼ HTMLë¡œ ë³€í™˜**
>     1. ìƒì„±ëœ API ë¬¸ì„œë¥¼ HTML íŒŒì¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
>     2. HTMLë¡œ ë³€í™˜ëœ API ë¬¸ì„œëŠ” HTML íŒŒì¼ ìì²´ë¥¼ ê³µìœ í•  ìˆ˜ë„ ìˆê³ , URLì„ í†µí•´ í•´ë‹¹ HTMLì— ì ‘ì†í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Spring Rest Docs ì„¤ì •

1. **build.gradle ì„¤ì •**
    
    ```java
    plugins {
    	id 'org.springframework.boot' version '2.7.1'
    	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    	id "org.asciidoctor.jvm.convert" version "3.3.2"    // (1)
    	id 'java'
    }
    
    /*
    
     (1) .adoc íŒŒì¼ í™•ì¥ìë¥¼ ê°€ì§€ëŠ” AsciiDoc ë¬¸ì„œë¥¼ ìƒì„±í•´ ì£¼ëŠ”
     Asciidoctorë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€
    
    */
    
    group = 'com.springboot'
    version = '0.0.1-SNAPSHOT'
    sourceCompatibility = '11'
    
    repositories {
    	mavenCentral()
    }
    
    ext { // (2) ext ë³€ìˆ˜ì˜ set() ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ API ë¬¸ì„œ ìŠ¤ë‹ˆí«ì´ ìƒì„±ë  ê²½ë¡œë¥¼ ì§€ì •
    	set('snippetsDir', file("build/generated-snippets"))
    }
    
    /* 
    (3)
    AsciiDoctorì—ì„œ ì‚¬ìš©ë˜ëŠ” ì˜ì¡´ ê·¸ë£¹ì„ ì§€ì •:asciidoctor taskê°€ ì‹¤í–‰ë˜ë©´ 
    ë‚´ë¶€ì ìœ¼ë¡œ (3)ì—ì„œ ì§€ì •í•œ â€˜asciidoctorExtensionsâ€™ë¼ëŠ” ê·¸ë£¹ì„ ì§€ì •
    */
    
    configurations {
    	asciidoctorExtensions
    }
    
    dependencies {
            /* (4) org.springframework.restdocs:spring-restdocs-mockmvc'ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ 
            spring-restdocs-coreì™€ spring-restdocs-mockmvc ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ëœë‹¤.*/
    	
    	testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc'
    
            /*(5)
            pring-restdocs-asciidoctor ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€
            (3)ì—ì„œ ì§€ì •í•œ asciidoctorExtensions ê·¸ë£¹ì— ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í¬í•¨ëœë‹¤
            */
    	asciidoctorExtensions 'org.springframework.restdocs:spring-restdocs-asciidoctor'
    
    	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    	implementation 'org.springframework.boot:spring-boot-starter-validation'
    	implementation 'org.springframework.boot:spring-boot-starter-web'
    	compileOnly 'org.projectlombok:lombok'
    	runtimeOnly 'com.h2database:h2'
    	annotationProcessor 'org.projectlombok:lombok'
    	testImplementation 'org.springframework.boot:spring-boot-starter-test'
    	implementation 'org.mapstruct:mapstruct:1.5.1.Final'
    	annotationProcessor 'org.mapstruct:mapstruct-processor:1.5.1.Final'
    	implementation 'org.springframework.boot:spring-boot-starter-mail'
    
    	implementation 'com.google.code.gson:gson'
    }
    
    // (6) :test task ì‹¤í–‰ ì‹œ, API ë¬¸ì„œ ìƒì„± ìŠ¤ë‹ˆí« ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ì„¤ì •
    tasks.named('test') {
    	outputs.dir snippetsDir
    	useJUnitPlatform()
    }
    
    /* (7) sciidoctor task ì‹¤í–‰ ì‹œ, Asciidoctor ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ 
    :asciidoctor taskì— asciidoctorExtensionsì„ ì„¤ì •*/
    
    tasks.named('asciidoctor') {
    	configurations "asciidoctorExtensions"
    	inputs.dir snippetsDir
    	dependsOn test
    }
    
    /* (8) :build task ì‹¤í–‰ ì „ì— ì‹¤í–‰ë˜ëŠ” task
    :copyDocument taskê°€ ìˆ˜í–‰ë˜ë©´ index.html íŒŒì¼ì´ 
    src/main/resources/static/docs ì— copy ë˜ë©°, 
    copy ëœ index.html íŒŒì¼ì€ API ë¬¸ì„œë¥¼ íŒŒì¼ í˜•íƒœë¡œ ì™¸ë¶€ì— ì œê³µí•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ ì‚¬ìš©*/
    
    task copyDocument(type: Copy) {
    	dependsOn asciidoctor            
    		// (8-1) :asciidoctor taskê°€ ì‹¤í–‰ëœ í›„ì— taskê°€ ì‹¤í–‰ë˜ë„ë¡ ì˜ì¡´ì„±ì„ ì„¤ì •
    	from file("${asciidoctor.outputDir}")   
    		// (8-2) build/docs/asciidoc/" ê²½ë¡œì— ìƒì„±ë˜ëŠ” index.htmlì„ copy
    	into file("src/main/resources/static/docs")   
    		// (8-3) src/main/resources/static/docs" ê²½ë¡œë¡œ index.htmlì„ ì¶”ê°€
    }
    
    build {
    	dependsOn copyDocument  
    		// (9):build taskê°€ ì‹¤í–‰ë˜ê¸° ì „ì— :copyDocument taskê°€ ë¨¼ì € ìˆ˜í–‰ë˜ë„ë¡ í•¨.
    }
    
    // (10)  ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ íŒŒì¼ì´ ìƒì„±í•˜ëŠ” :bootJar task ì„¤ì •
    bootJar {
    	dependsOn copyDocument    
    		// (10-1)  :bootJar task ì‹¤í–‰ ì „ì— :copyDocument taskê°€ ì‹¤í–‰ë˜ë„ë¡ ì˜ì¡´ì„±ì„ ì„¤ì •
    	from ("${asciidoctor.outputDir}") { 
    		into 'static/docs'    
    		 /*(10-2) Asciidoctor ì‹¤í–‰ìœ¼ë¡œ ìƒì„±ë˜ëŠ” index.html íŒŒì¼ì„ jar íŒŒì¼ ì•ˆì— ì¶”ê°€
    		 jar íŒŒì¼ì— index.htmlì„ ì¶”ê°€í•´ ì¤Œìœ¼ë¡œì¨ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
    		 (http://localhost:8080/docs/index.html) í›„, API ë¬¸ì„œë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.*/
    	}
    }
    
    ```
    
2. **API ë¬¸ì„œ ìŠ¤ë‹ˆí«ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í…œí”Œë¦¿ API ë¬¸ì„œ ìƒì„±**
    - Gradle ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì•„ë˜ ê²½ë¡œì— í•´ë‹¹í•˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
        - `src/docs/asciidoc/`
    - ë‹¤ìŒìœ¼ë¡œ `src/docs/asciidoc/` ë””ë ‰í† ë¦¬ ë‚´ì— ë¹„ì–´ìˆëŠ” í…œí”Œë¦¿ ë¬¸ì„œ(`index.adoc`)ë¥¼ ìƒì„±í•´ ì£¼ë©´ ëœë‹¤.

### ìŠ¬ë¼ì´ìŠ¤í…ŒìŠ¤íŠ¸

1. MemberControllerê°€ ìš”ì²­ì„ ì˜ ì „ë‹¬ë°›ê³ , ì‘ë‹µì„ ì˜ ì „ì†¡í•˜ë©° ìš”ì²­ê³¼ ì‘ë‹µì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©´ API ë¬¸ì„œ ìŠ¤í™ ì •ë³´ë¥¼ ì˜ ì½ì–´ ë“¤ì—¬ì„œ ì ì ˆí•œ ë¬¸ì„œë¥¼ ì˜ ìƒì„±í•˜ëŠëƒ í•˜ëŠ” ê²ƒì„ Testí•˜ë©´ ë¨
2. MemberServiceì™€ MemberMapperì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ ê´€ê³„ë¥¼ ë‹¨ì ˆ â‡’  MemberServiceì™€ MemberMapperì˜ Mock Beanì„ ì£¼ì…

1ï¸âƒ£ **ì• ë„ˆí…Œì´ì…˜** 

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/8b6d4b7c-dcc8-434e-a708-c9b646f13cad" width=300/>

1. `@WebMvcTest` ì• ë„ˆí…Œì´ì…˜ì€ Controllerë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ì „ìš© ì• ë„ˆí…Œì´ì…˜, ê´„í˜¸ ì•ˆì—ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒ Controller í´ë˜ìŠ¤ë¥¼ ì§€ì •
2. @MockBean(JpaMetamodelMappingContext.class)

> **@SpringBootTest vs @WebMvcTest**
> 
> 
> ê¸°ì¡´ì—ëŠ”`@SpringBootTest` + `@AutoConfigureMockMvc` ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ Controllerì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰
> 
> **`@SpringBootTest`ì™€  `@WebMvcTest`ì˜ ì°¨ì´ì ì€?**
> ë¨¼ì € **`@SpringBootTest`** ì• ë„ˆí…Œì´ì…˜ì€ **`@AutoConfigureMockMvc`**ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ Controllerë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ”ë°, í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì „ì²´ Beanì„ ApplicationContextì— ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
> í•œë§ˆë””ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì€ í¸ë¦¬í•˜ê¸´ í•œë° ì‹¤í–‰ ì†ë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼.
> 
> **`@WebMvcTest`** ì• ë„ˆí…Œì´ì…˜ì˜ ê²½ìš° Controller í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ Beanë§Œ ApplicationContextì— ë“±ë¡í•˜ê¸° ë•Œë¬¸ì— ì‹¤í–‰ ì†ë„ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë¹ ë¥´ë‹¤.
> 
> ë‹¤ë§Œ, Controllerì—ì„œ ì˜ì¡´í•˜ê³  ìˆëŠ” ê°ì²´ê°€ ìˆë‹¤ë©´ í•´ë‹¹ ê°ì²´ì— ëŒ€í•´ì„œ Mock ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì¡´ì„±ì„ ì¼ì¼ì´ ì œê±°í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
> 
> ê²°ê³¼ì ìœ¼ë¡œ **@SpringBootTestëŠ” ë°ì´í„°ë² ì´ìŠ¤ê¹Œì§€ ìš”ì²­ í”„ë¡œì„¸ìŠ¤ê°€ ì´ì–´ì§€ëŠ” í†µí•© í…ŒìŠ¤íŠ¸**ì— ì£¼ë¡œ ì‚¬ìš©ë˜ê³ , **@WebMvcTes**tëŠ” **Controllerë¥¼ ìœ„í•œ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ì— ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.**
> 

2ï¸âƒ£ **MemberControllerì˜ postMember() í•¸ë“¤ëŸ¬ ë©”ì„œë“œì— ëŒ€í•œ API ìŠ¤í™ì •ë³´ ì¶”ê°€**

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/f11cd3ca-ea79-49ca-83ac-ab8ca5be800c" width=500/>

1.  ë…¸ë€ë°•ìŠ¤ ë‚´ì˜ **document(â€¦)** ë©”ì„œë“œëŠ” API ìŠ¤í™ ì •ë³´ë¥¼ ì „ë‹¬ë°›ì•„ì„œ ì‹¤ì§ˆì ì¸ ë¬¸ì„œí™” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” **`RestDocumentationResultHandler` í´ë˜ìŠ¤ì—ì„œ ê°€ì¥ í•µì‹¬ ê¸°ëŠ¥ì„ í•˜ëŠ” ë©”ì„œë“œ**
2. **`document()`** ë©”ì„œë“œì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” **API ë¬¸ì„œ ìŠ¤ë‹ˆí«ì˜ ì‹ë³„ì ì—­í• **ì„ í•˜ë©°, â€œ`post-member`â€ë¡œ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— ë¬¸ì„œ ìŠ¤ë‹ˆí«ì€ `post-member` ë””ë ‰í† ë¦¬ í•˜ìœ„ì— ìƒì„±ëœë‹¤.
3. <span style="color:OrangeRed"> **getRequestPreProcessor() ì™€ getResponsePreProcessor()**</span>
    
    ë¬¸ì„œ ìŠ¤ë‹ˆí«ì„ ìƒì„±í•˜ê¸° ì „ì— requestì™€ responseì— í•´ë‹¹í•˜ëŠ” ë¬¸ì„œ ì˜ì—­ì„ ì „ì²˜ë¦¬í•˜ëŠ” ì—­í• ì„ í•˜ëŠ”ë° ì•„ë˜ì™€  ê°™ì´ ê³µí†µí™”í•œ í›„, ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì—ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨
    
    ```java
    package com.springboot.util;
    
    import org.springframework.restdocs.operation.preprocess.OperationRequestPreprocessor;
    import org.springframework.restdocs.operation.preprocess.OperationResponsePreprocessor;
    
    import static org.springframework.restdocs.operation.preprocess.Preprocessors.*;
    
    public interface ApiDocumentUtils {
       static OperationRequestPreprocessor getRequestPreProcessor() {
           return preprocessRequest(prettyPrint());
        }
    
        static OperationResponsePreprocessor getResponsePreProcessor() {
            return preprocessResponse(prettyPrint());
        }
    }
    
    ```
    
4. `requestFields(â€¦)`ëŠ” ë¬¸ì„œë¡œ í‘œí˜„ë  request bodyë¥¼ ì˜ë¯¸, `List<FieldDescriptor>`ì˜ ì›ì†Œì¸
`FieldDescriptor` ê°ì²´ê°€ request bodyì— í¬í•¨ëœ ë°ì´í„°ë¥¼ í‘œí˜„
5.  `responseHeaders(â€¦)`ëŠ” ë¬¸ì„œë¡œ í‘œí˜„ë  response headerë¥¼ ì˜ë¯¸,íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ëŠ” `HeaderDescriptor` ê°ì²´ê°€ response headerë¥¼ í‘œí˜„
6. ì‹¤í–‰ ê²°ê³¼ê°€ â€œ`passed`â€ì´ë©´ ìš°ë¦¬ê°€ ì‘ì„±í•œ API ìŠ¤í™ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¬¸ì„œ ìŠ¤ë‹ˆí«ì´ ë§Œë“¤ì–´ì§.
    
    
<br/>

3ï¸âƒ£ **MemberControllerì˜ patchMember() í•¸ë“¤ëŸ¬ ë©”ì„œë“œì— ëŒ€í•œ API ìŠ¤í™ì •ë³´ ì¶”ê°€**

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/e5d47dcb-df56-4ca3-84b4-ee4eec038cc0" width=500/>

<img src="https://github.com/quokkavely/quokkavely.github.io/assets/165968530/e4496ad1-7633-44f6-83bf-8303815ef23a"/>

1. `memberId`ì˜ ê²½ìš°, `path variable` ì •ë³´ë¡œ memberIdë¥¼ ì „ë‹¬ë°›ê¸° ë•Œë¬¸ì— MemberDto.Patch DTO í´ë˜ìŠ¤ì—ì„œ **request bodyì— ë§¤í•‘ë˜ì§€ ì•ŠëŠ” ì •ë³´ â‡’** ê·¸ë˜ì„œ (2)ì™€ ê°™ì´ ignored()ë¥¼ ì¶”ê°€í•´ì„œ **API ìŠ¤í™ ì •ë³´ì—ì„œ ì œì™¸**
2. íšŒì›ì •ë³´ëŠ” ì„ íƒì ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•˜ë¯€ë¡œ optional()ì„ ì¶”ê°€í•˜ì—¬ ì„ íƒì •ë³´ë¡œ ì„¤ì •í•¨.

---

